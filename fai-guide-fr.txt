 Guide FAI (Installation entièrement automatique)
Thomas Lange
< lange@informatik.uni-koeln.de >
Version 5.3, 16 janv. 2017
Table des matières
Abstrait

FAI est un système non interactif permettant d'installer, de personnaliser et de gérer les configurations de systèmes et de logiciels Linux sur les ordinateurs ainsi que sur les machines virtuelles et les environnements chroot, des petits réseaux aux grandes infrastructures et clusters.

Ce manuel décrit le logiciel d'installation entièrement automatique. Cela inclut l'installation des paquets, la configuration du serveur, la création de la configuration et la gestion des erreurs.

  +-----------------------------------------------------------------------+ 
  | This manual describes FAI 5.3 but most things are also valid for 4.x. | +-----------------------------------------------------------------------+ 

(C) 2000-2017 Thomas Lange
droits d'auteur

Ce manuel est un logiciel libre; Vous pouvez le redistribuer et / ou le modifier selon les termes de la Licence Publique Générale GNU publiée par la Free Software Foundation; Soit la version 2, soit (à votre choix) toute version ultérieure.

Ceci est distribué dans l'espoir qu'il sera utile, mais sans aucune garantie ; Sans même la garantie implicite de qualité marchande ou d'adaptation à un usage particulier. Pour plus de détails, consultez la GNU General Public License.

Une copie de la GNU General Public License est disponible sous la forme / usr / share / common-licenses / GPL dans la distribution Debian GNU / Linux ou sur le World Wide Web sur le site GNU Vous pouvez également l'obtenir en écrivant à la Free Software Foundation , Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, États-Unis
introduction
Disponibilité

Page d'accueil

    Http://fai-project.org 
Wiki wiki

    Http://wiki.fai-project.org 
Télécharger

    Http://fai-project.org/download 
Entrée pour sources.list

    deb http://fai-project.org/download jessie koeln
Pages du manuel

    Http://fai-project.org/doc/man/ 
Liste de diffusion

    Https://lists.uni-koeln.de/mailman/listinfo/linux-fai 
Retour d'information

    Envoyez vos commentaires et vos commentaires à fai@fai-project.org ou à la liste de diffusion . 
Bogues

    Utiliser le système de suivi des bogues Debian (BTS) http://bugs.debian.org 
Changements visibles par l'utilisateur

    Http://fai-project.org/NEWS 
Arbre source via git

    Git clone git: //github.com/faiproject/fai.git 
Voir l'arbre source avec http

    Https://github.com/faiproject/fai 

Les pages man incluent toujours des informations à jour et beaucoup de détails sur toutes les commandes FAI. Alors, n'oubliez pas de les lire attentivement. Lisez maintenant ce manuel, puis profitez de l'installation entièrement automatique et de votre temps économisé.
Motivation

Avez-vous déjà effectué des installations identiques d'un système d'exploitation à plusieurs reprises? Souhaitez-vous être en mesure d'installer un cluster Linux avec des dizaines de nœuds à lui seul?

Répéter la même tâche encore et encore est ennuyeux - et conduira certainement à des erreurs. Aussi beaucoup de temps pourrait être sauvé si les installations ont été faites automatiquement. Un processus d'installation avec interaction manuelle n'est pas à l'échelle. Mais les grappes ont l'habitude de croître au fil des ans. Pensez à long terme plutôt que de planifier quelques mois dans l'avenir.

En 1999, j'ai dû effectuer une installation d'un cluster Linux avec un serveur et 16 clients. Puisque j'ai eu beaucoup d'expérience en faisant des installations automatiques des systèmes d'exploitation de Solaris sur le matériel de SUN SPARC, l'idée de construire une installation automatique pour Debian est née. Solaris dispose d'une fonctionnalité d'installation automatique appelée JumpStart
[Guide d'installation avancée Solaris 8 à l'adresse https://docs.oracle.com/cd/E19455-01/806-0957/806-0957.pdf ]
. En conjonction avec les scripts d'auto-installation de Casper Dik
[ Http://www.science.uva.nl/pub/solaris/auto-install ]
, Je pourrais sauver beaucoup de temps non seulement pour chaque nouvel ordinateur de SUN, mais aussi pour la réinstallation des postes de travail existants. Par exemple, j'ai dû construire un LAN temporaire avec quatre stations de travail SUN pour une conférence, qui a duré seulement quelques jours. J'ai retiré ces postes de travail de notre réseau de recherche habituel et mis en place une nouvelle installation pour la conférence. Quand il était terminé, j'ai simplement intégré les postes de travail dans le réseau de recherche, redémarré une seule fois, et après une demi-heure, tout était opérationnel comme avant. La configuration de tous les postes de travail était exactement la même qu'avant la conférence, car tout était effectué par le même processus d'installation. J'ai également utilisé l'installation automatique pour réinstaller un poste de travail après un disque dur endommagé avait été remplacé. Il m'a fallu deux semaines pour recevoir le nouveau disque dur, mais seulement quelques minutes après l'installation du nouveau disque, le poste de travail fonctionnait comme avant. Et c'est pourquoi j'ai choisi d'adapter cette technique à un cluster de PC sous Linux.
Comment fonctionne la FAI

Le client d'installation qui sera installé à l'aide de FAI, est démarré via une carte réseau ou à partir d'un CD ou d'une clé USB. Il obtient une adresse IP et démarre un noyau Linux qui monte son système de fichiers racine via NFS (nfsroot) du serveur d'installation. Une fois le noyau démarré, le script de démarrage FAI exécute l'installation automatique qui n'a pas besoin d'interaction. Tout d'abord, les disques durs seront partitionnés, les systèmes de fichiers seront créés et des progiciels seront ensuite installés. Après cela, le nouveau système d'exploitation installé est configuré selon vos besoins locaux en utilisant quelques scripts. Enfin, le nouveau système d'exploitation sera démarré à partir du disque local.

Les détails sur la façon d'installer l'ordinateur (la configuration) sont stockés dans l'espace de configuration du serveur d'installation. Les fichiers de configuration sont partagés entre des groupes d'ordinateurs s'ils sont similaires en utilisant le concept de classe. Vous n'avez donc pas besoin de créer une configuration pour chaque nouvel hôte. Par conséquent, FAI est une méthode évolutive pour installer un gros cluster avec un grand nombre de nœuds même si leur configuration n'est pas identique.

FAI peut également être utilisé comme un système de sauvetage ou pour l'inventaire matériel. Vous pouvez démarrer votre ordinateur, mais il n'effectuera pas une installation. Au lieu de cela, il exécutera un Debian GNU / Linux entièrement fonctionnel sans utiliser les disques durs locaux. Ensuite, vous pouvez effectuer une connexion à distance et sauvegarder ou restaurer une partition de disque, vérifier un système de fichiers, inspecter le matériel ou effectuer toute autre tâche.
Caractéristiques

    Une installation entièrement automatisée peut être effectuée.

    Très rapide installation sans surveillance.

    Système flexible grâce à un concept de classe simple.

    Mise à jour des systèmes en cours d'exécution sans réinstallation.

    Création facile d'un environnement de virtualisation ou d'un chroot

    Les hôtes peuvent démarrer à partir d'une carte réseau, d'un CD, d'une clé USB.

    Création simple d'un CD d'installation ou d'une clé USB.

    PXE avec la méthode de démarrage DHCP est pris en charge.

    ReiserFS, ext3 / ext4, btrfs et support de système de fichiers XFS.

    Support logiciel RAID et LVM.

    Détection automatique du matériel.

    Vous pouvez déployer Debian, Ubuntu, CentOS, SuSE, Scientific Linux

    Connexion à distance via ssh lors du processus d'installation possible.

    Toutes les configurations similaires sont partagées entre tous les clients d'installation.

    Les fichiers journaux de toutes les installations sont enregistrés sur le serveur d'installation.

    Les scripts Shell, Perl, Python, Ruby, expect et CFEngine sont pris en charge lors de l'étape de personnalisation.

    Prise en charge de nombreux protocoles comme NFS, FTP, HTTP, git

    Peut être utilisé comme un système de sauvetage et pour l'inventaire matériel.

    Prise en charge du client sans disque.

    Ajoutez facilement vos propres fonctions via des crochets ou modifiez le comportement par défaut.

    Clonage de machines utilisant des images de disque est pris en charge 

Le temps de l'installation

Le temps d'installation est déterminé par la quantité de logiciel et la vitesse du disque dur. Voici quelques exemples de temps. Tous les clients d'installation avaient une carte réseau 1Gbit installée.
CPU 	RAM 	Disque 	Logiciel installé 	temps

I7-3770T 2.50GHz
	

8 Go
	

SSD
	

Logiciel 6 Go
	

8,5 min

Core-i7 3.2GHz
	

6 Go
	

Disque SATA
	

Logiciel 4,3 Go
	

7 min

Core-i7 3.2GHz
	

6 Go
	

Disque SATA
	

Logiciel 471 Mo
	

77 secondes

Intel Core2 Duo
	

2 Go
	

Disque SATA
	

Logiciel 3 Go
	

14 min
Quickstart - Pour l'utilisateur impatient
Ma première installation

Sans plus tarder, cette section fournira une démonstration rapide et facile d'une installation entièrement automatique à l'aide du CD FAI et d'une machine virtuelle.

Il suffit de télécharger l' image ISO du CD à partir de http://fai-project.org/fai-cd et de démarrer votre VM à l'aide de ce CD. Vous verrez un menu grub où vous pouvez choisir parmi différents types d'installation.

Cette installation s'exécutera sans serveur d'installation. L'installation du CD est identique à celle exécutée dans un environnement réseau à l'aide du serveur d'installation FAI.
Mon premier serveur d'installation

S'il vous plaît noter, si vous avez l'intention d'utiliser QEMU / KVM, vous devez avoir qemu-kvm qemu-utils pont-utils installés sur la machine à utiliser fai-mk-network et fai-kvm
[Fai-kvm a besoin de beaucoup de ram pour la vm, à cause de la mise en cache de / var, 2GB sont OK]
.

Vous pouvez le faire via

 # apt-get install qemu-kvm qemu-utils bridge-utils 

Si vous avez l'intention d'utiliser VMware ou VirtualBox, assurez-vous que votre client utilise une connexion réseau pontée. En outre, il n'est pas possible d'utiliser des interfaces réseau pontées via le réseau sans fil, car la plupart des cartes réseau WiFi ne prennent pas en charge cette fonctionnalité.

Pour configurer votre propre serveur FAI, nous vous recommandons de créer un réseau de test sur votre ordinateur et d'utiliser KVM. Pour créer ce réseau privé, il ya le script fai-mk-network (dans le paquet fai-server). Il configure un pont logiciel avec plusieurs dispositifs de dérivation qui appartiennent à l'utilisateur <username> .

 fai-mk-network <username> 

Après cela, vous pouvez utiliser fai-kvm (-h vous aidera) pour démarrer des machines virtuelles en utilisant KVM qui sont connectés à ce réseau privé. Fais attention. Par défaut, fai-kvm créera les images de disque pour les machines /tmp dans /tmp , qui est un disque RAM sur la plupart des systèmes. Il n'y a aucun problème à créer une image de disque vide de 20G dans / tmp (même si cette partition est de 4 Go de taille), mais alors que la VM écrit des données sur son disque, cela commencera à consommer de l'espace dans /tmp .

Démarrez le premier hôte virtuel, qui deviendra le serveur FAI
[Cette installation consommera environ 2 Go d'espace dans /tmp .]
:

 fai-kvm -Vn -s20 -u 1 cd fai-cd.iso 

Dans le menu grub faiserver, fixed IP . Cela va installer un hôte appelé faiserver avec IP 192.168.33.250 qui contient tous les logiciels nécessaires pour un serveur FAI. Il configurera également un cache de paquets local (en utilisant apt-cacher-ng). Une fois l'installation terminée, redémarrez la machine. Lors du premier démarrage du nouveau système, il configurera automatiquement le nfsroot. Cela peut prendre quelques minutes.

Après cela, vous pouvez démarrer des hôtes supplémentaires en utilisant le démarrage réseau. Pour chaque nouvel hôte, vous devez utiliser une valeur différente pour -u , qui sera utilisée pour générer des adresses MAC différentes et utiliser des noms de fichier d'image de disque différents.

 fai-kvm -Vn -u 2 pxe 

Ces clients d'installation vous montreront un menu, où vous pouvez sélectionner le type d'installation que vous souhaitez effectuer. Si le client d'installation ne trouve pas le serveur, c'est généralement parce que fai-monitor ne fonctionne plus. Cela peut se produire si vous redémarrez le faiserver après l'installation. Pour remédier à cela, exécutez simplement fai-monitor sur le faiserver et relancez le démarrage du client.

Un autre client pourrait être lancé avec:

 fai-kvm -Vn -u 3 pxe 

Vous pouvez démarrer autant de machines dans le réseau que les périphériques de prise sont disponibles. Toutes ces machines peuvent se connecter à l'Internet extérieur, mais sont seulement accessibles à partir de votre machine hôte.
Vue d'ensemble et concepts

FAI est un système non interactif permettant d'installer, de personnaliser et de gérer les configurations de systèmes et de logiciels Linux sur les ordinateurs ainsi que sur les machines virtuelles et les environnements chroot, des petits réseaux aux grandes infrastructures et clusters. Vous pouvez prendre un ou plusieurs PC vierges, mettre sous tension et après quelques minutes, Linux est installé, configuré et exécuté sur l'ensemble du cluster, sans aucune interaction nécessaire. Ainsi, il s'agit d'une méthode évolutive pour installer et mettre à jour un cluster sans surveillance avec peu d'efforts impliqués. FAI utilise le système d'exploitation Linux et une collection de scripts shell et Perl pour le processus d'installation. Les modifications apportées aux fichiers de configuration du système d'exploitation peuvent être effectuées par CFEngine, shell (bash et zsh), Perl, Python, Ruby et attendent des scripts.

Le groupe cible de FAI sont des administrateurs système qui doivent installer Linux sur une ou même des centaines d'ordinateurs. Parce qu'il s'agit d'un outil d'installation à usage général, il peut être utilisé pour l'installation d'un cluster Beowulf, d'une batterie de rendu ou d'un laboratoire Linux ou d'une salle de classe. De plus, des réseaux Linux de grande envergure avec différents matériels ou différentes exigences d'installation sont faciles à établir à l'aide de FAI. Mais n'oubliez pas de planifier votre installation. Le chapitre [plan] contient quelques conseils utiles pour ce sujet.
Conditions Générales

Premièrement, certains termes utilisés dans ce manuel sont décrits.

Installer le serveur

    Il fournit les services DHCP, TFTP et NFS ainsi que les données de configuration pour tous les clients d'installation. Dans les exemples de ce manuel, cet hôte s'appelle faiserver . L'hôte où le package fai-server est installé. 
Installer le client

    Un hôte qui sera installé à l'aide de FAI et une configuration fournie par le serveur d'installation. Aussi appelé client pour courte. Dans ce manuel, les hôtes d'exemple sont appelés demohost, xfcehost, gnomehost ... Cet ordinateur doit démarrer à partir de son interface réseau à l'aide de PXE. 
Espace de configuration

    Une structure de sous-répertoire contenant plusieurs fichiers. Ces fichiers décrivent les détails de la manière dont l'installation des clients sera effectuée. Toutes les données de configuration sont stockées ici. Il est également appelé config space pour le court. Il comprend des informations sur:

        Disposition du disque dur dans un format similaire à fstab

        Systèmes de fichiers locaux, leurs types, points de montage et options de montage

        Logiciels

        Disposition du clavier, fuseau horaire, configuration Xorg, systèmes de fichiers distants, comptes utilisateurs, imprimantes ... 

    Le package fai-doc inclut un exemple d'espace de configuration incluant des exemples pour les hôtes utilisant l'environnement XFCE et GNOME parmi d'autres exemples. 
Nfsroot, NFS-Root

    Un système de fichiers situé sur le serveur d'installation. Pendant le processus d'installation, c'est le système de fichiers complet pour les clients d'installation. Tous les clients partagent le même nfsroot, qu'ils montent en lecture seule. Le nfsroot a besoin d'environ 690 Mo d'espace disque libre. 
TFTP

    Sert aux clients l'initrd et le noyau utilisés pour le processus d'installation. Avec le système de fichiers servi par NFS, ces deux composent un OS temporaire dans lequel les installations sont exécutées. 
Classes FAI

    Les classes sont des noms qui déterminent quel fichier de configuration est sélectionné. Si un client appartient à la classe WEBSERVER, il sera configuré en tant que serveur Web, la classe DESKTOP pour, par exemple, détermine les progiciels qui seront installés. 
profil

    Un profil FAI est juste une liste de classes FAI assiged à un nom de profil, qui est étendu par une description de ce profil. C'est-à-dire que l'on peut avoir deux profils "Webserver", l'un incluant la classe APACHE, y compris la classe NGINX, pour ensuite installer la solution webserver respective. 
les tâches

    L'installation d'un client se compose de plusieurs parties, appelées tâches. Les tâches sont des sous-programmes prédéfinis qui effectuent une certaine partie de la FAI. Les tâches FAI suivantes sont exécutées au cours d'une installation sur les clients d'installation. 

confdir               # get the config space
setup                 # some initialization, start sshd on demand
defclass              # define FAI classes
defvar                # define variables
action                # evaluate FAI_ACTION
install               # Start the installation
partition             # partition the harddisks, create file systems
mountdisks            # mount the file systems
extrbase              # extract the base.tar.xz
debconf               # do the Debian debconf preseeding
repository            # prepare access to the package repository
updatebase            # Set up package tools and update packages
instsoft              # install software packages
configure             # call customization scripts
finish                # do some cleanup, show installation statistics
tests                 # call tests if defined
chboot                # call fai-chboot on the install server
savelog               # save log files to local and remote location
faiend                # reboot host, eject CD if needed

Il s'agit de tâches qui ne sont exécutées que lorsqu'une action différente est exécutée

dirinstall           # install a chroot environment
softupdate           # only do the system configuration
sysinfo              # print detailed system information
inventory            # print short hardware inventory list 

Pour une description plus détaillée des tâches , voir [tâches] .

Notez que vous n'êtes pas limité aux tâches FAI. Vous pouvez également définir des programmes ou des scripts supplémentaires qui seront exécutés à certaines occasions. On les appelle des crochets .

Crochets

    Les crochets sont des plugins, ils peuvent ajouter des fonctionnalités supplémentaires au processus d'installation ou même remplacer des tâches entières de FAI. Les crochets sont expliqués en détail dans [crochets] . 

Le concept de classe

Les classes sont utilisées dans presque toutes les tâches de l'installation. Les classes déterminent quels fichiers de configuration choisir parmi une liste d'alternatives disponibles. Pour déterminer les fichiers de configuration à utiliser, FAI recherche la liste des classes définies et utilise tous les fichiers de configuration correspondant à un nom de classe
[Il est également possible d'utiliser uniquement le fichier de configuration avec la plus haute priorité puisque l'ordre des classes définit une priorité de bas à haut dans la liste des classes. ]
. La boucle suivante implémente cette fonction en pseudo code shell:

 for class in $all_classes; do
   if [ -r $config_dir/$class ]; then      # if a file with name $class exists
      your_command $config_dir/$class      # call a command with this file name
      # exit if only the first matching file is needed
   fi
done

La caractéristique très intéressante de ceci est que vous pouvez ajouter une nouvelle alternative de configuration et elle sera automatiquement utilisée par FAI sans changer le code, si le fichier de configuration utilise un nom de classe.

C'est parce que la boucle détecte automatiquement les nouveaux fichiers de configuration qui doivent être utilisés. L'idée d'utiliser des classes en général et d'utiliser certains fichiers correspondant à un nom de classe pour une configuration est adoptée à partir des scripts d'installation par Casper Dik pour Solaris. Cette technique s'est avérée très utile et facile.

Vous pouvez regrouper plusieurs hôtes partageant les mêmes fichiers de configuration en utilisant la même classe. Vous pouvez également diviser l'ensemble des données de configuration pour tous les clients en plusieurs classes et les utiliser comme des briques de lego et construire la configuration entière pour un seul client en assemblant les briques ensemble.

Si un client appartient à la classe A , nous disons que la classe A est définie pour ce client. Une classe n'a pas de valeur, elle est juste définie ou non définie.

Les classes déterminent comment l'installation est effectuée. Par exemple, un client d'installation peut être configuré pour obtenir le bureau XFCE en y ajoutant simplement la classe XFCE . Naturellement, des configurations plus granulaires sont également possibles. Par exemple, les classes peuvent décrire comment le disque dur doit être partitionné, ils peuvent définir quels paquets logiciels seront installés ou quelles étapes de personnalisation seront exécutées.

Souvent, une configuration client est créée en modifiant ou en ajoutant uniquement les classes auxquelles ce client appartient, ce qui rend l'installation d'un nouveau client très facile. Ainsi, aucune information supplémentaire ne doit être ajoutée à l'espace de configuration si les classes existantes suffisent à vos besoins.

Comme vous pouvez le voir, les classes sont un pilier central de la personnalisation de votre espace de configuration et de l'installation de votre client. Pour définir vos propres classes, reportez-vous à [définition des classes] .
Configurer votre faiseur

Voici comment configurer le serveur d'installation en quelques minutes. Les étapes suivantes sont nécessaires:

    Configurer le serveur d'installation

        Installer des packages FAI

        Créez le nfsroot

        Copiez les exemples dans l'espace de configuration

        Configurer les démons de réseau

        Créer les configurations PXELINUX 

    Démarrage et installation des clients 

Installer les paquetages FAI

    Installez la clé du référentiel de package de projet FAI:

    Ajoutez l'URL du référentiel de packages du projet FAI.

    Installez le paquet fai-quickstart sur votre serveur d' installation . 

 # wget -O - http://fai-project.org/download/074BCDE4.asc | apt-key add - # echo "deb http://fai-project.org/download jessie koeln" > /etc/apt/sources.list.d/fai.list # apt-get update # aptitude install fai-quickstart 

Cela installera également les paquets pour les démons de serveur DHCP, TFTP et NFS.
Créez le nfsroot

    Activez également le référentiel de package du projet FAI dans un autre fichier sources.list qui est utilisé lors de la construction du nfsroot. Ensuite, activez l'utilisateur de journal pour FAI. 

 # sed -i -e 's/^#deb/deb/' /etc/fai/apt/sources.list # sed -i -e 's/#LOGUSER/LOGUSER/' /etc/fai/fai.conf 

    Par défaut, FAI utilise http://httpredir.debian.org comme mirror de paquets, qui devrait tenter de trouver un référentiel de paquets rapide pour vous.
    [Si vous souhaitez utiliser un miroir plus rapide, ajustez l'URL dans /etc/fai/apt/sources.list et FAI_DEBOOTSTRAP dans /etc/fai/nfsroot.conf avant d'appeler fai-setup.]
    Maintenant, nous pouvons exécuter fai-setup(8)
    [Ceci appellera fai-make-nfsroot(8) interne.]
    Et vérifier si tout s'est bien passé. Le fichier journal est écrit dans /var/log/fai/fai-setup.log. 

 # fai-setup -v 

    Ce sont quelques-unes des lignes que vous verrez à la fin de fai-setup . Un exemple complet de fai-setup.log est disponible sur la page Web FAI à l'adresse http://fai-project.org/logs/fai-setup.log . 

 FAI packages and related packages inside the nfsroot: dracut 044+189-2 dracut-network 044+189-2 fai-client 5.3.3~bpo8+2 fai-nfsroot 5.3.3~bpo8+2 fai-setup-storage 5.3.3~bpo8+2 Waiting for background jobs to finish fai-make-nfsroot finished properly. Log file written to /var/log/fai/fai-make-nfsroot.log Adding line to /etc/exports: /srv/fai/config 192.168.33.250/25(async,ro,no_subtree_check) Adding line to /etc/exports: /srv/fai/nfsroot 192.168.33.250/25(async,ro,no_subtree_check,no_root_squash) Reloading nfs-kernel-server configuration (via systemctl): nfs-kernel-server.service. You have no FAI configuration space yet. Copy the simple examples with: cp -a /usr/share/doc/fai-doc/examples/simple/* /srv/fai/config Then change the configuration files to meet your local needs. Please don't forget to fill out the FAI questionnaire after you've finished your project with FAI. FAI setup finished. Log file written to /var/log/fai/fai-setup.log 

    Fai-setup a créé le LOGUSER, le nfsroot et a ajouté des lignes supplémentaires à / etc / exports . Les sous-répertoires ajoutés à / etc / exports sont exportés via NFS v3, de sorte que tous les clients d'installation dans le même sous-réseau peuvent les monter via NFS. 

Création de l'espace de configuration

Installez les exemples simples dans l'espace de configuration
[Ces fichiers ne doivent pas appartenir au compte racine.]
.

 $ cp -a /usr/share/doc/fai-doc/examples/simple/* /srv/fai/config/ 

Ces exemples contiennent la configuration pour certains hôtes d'exemple. Selon le nom d'hôte utilisé, votre ordinateur sera configuré comme suit:

Demohost

    Une machine qui n'a besoin que d'un petit disque dur. Cette machine est configurée avec le réseau en tant que client DHCP, et une démo de compte est créée. 
Xfcehost

    Un bureau XFCE est installé, utilisant LVM, et la démo du compte est créée. 
Gnomehost

    Un bureau GNOME est installé et la démo du compte est créée. 
Autres noms d'hôte

    Les hôtes disposant d'un autre nom d'hôte utiliseront notamment les classes FAIBASE, DHCPC et GRUB. 

Tous les hôtes auront un compte appelé demo avec mot de passe fai . Le compte root a également le mot de passe fai .

Si le menu d'indicateur FAI est ajouté, au lieu d'utiliser le nom d'hôte pour déterminer le type d'installation, un menu est présenté et l'utilisateur peut choisir un profil pour l'installation.
Configurer les démons du réseau

Pour démarrer le client d'installation via PXE, le serveur d'installation a besoin d'un DHCP et d'un démon TFTP en cours d'exécution. Le paquet fai-quickstart a déjà installé les progiciels pour ces daemons. En outre, le paquetage du serveur NFS pour l'exportation du nfsroot et de l'espace de configuration a été installé.
Configuration du démon DHCP

Idéalement, votre faiserver doit également être votre serveur DHCP. Si ce n'est pas le cas, demandez à l'administrateur responsable du serveur DHCP de le configurer conformément à cette section. En option, il est possible d'éviter cela en utilisant la fonctionnalité [autodiscover] diffusée dans FAI 5.0.

Un exemple pour dhcpd.conf(5) est fourni avec le paquet fai-doc . Commencez à utiliser cet exemple et regardez toutes les options qui y sont utilisées.

 # cp /usr/share/doc/fai-doc/examples/etc/dhcpd.conf /etc/dhcp/ 

Les seules informations spécifiques FAI contenues dans ce fichier de configuration sont de définir le filename de filename à fai/pxelinux.0 et de définir next-server et server-name sur le nom de votre serveur d' fai/pxelinux.0 . Toutes les autres informations sont uniquement des données liées au réseau, qui est utilisé dans presque toutes les configurations DHCP. Ajustez ces paramètres de réseau à vos besoins locaux.

 deny unknown-clients; option dhcp-max-message-size 2048; use-host-decl-names on; subnet 192.168.33.0 netmask 255.255.255.0 { option routers 192.168.33.250; option domain-name "my.example"; option domain-name-servers 192.168.33.250; option time-servers faiserver; option ntp-servers faiserver; server-name faiserver; next-server faiserver; filename "fai/pxelinux.0"; } 

Si vous apportez des modifications à la configuration DHCP, vous devez redémarrer le démon.

 # /etc/init.d/isc-dhcp-server restart 

Si vous disposez de plusieurs interfaces réseau, vous pouvez définir l'interface que le serveur écoutera dans / etc / default / isc-dhcp-server . Par défaut, le démon DHCP écrit ses messages de journalisation dans /var/log/daemon.log .
Ajout d'une entrée d'hôte à DHCP

L'adresse MAC est donnée par le matériel de la carte réseau. Pour chaque client d'installation, vous collectez son adresse MAC et la mappez à une adresse IP et à un nom d'hôte. Tout d'abord, nous ajoutons l'adresse IP et le nom d'hôte à / etc / hosts
[Vous pouvez également ajouter ceci dans votre système de noms de domaine (DNS)]
.

 192.168.33.100 demohost 

Le mappage de l'adresse MAC à l'adresse IP est effectué dans le fichier dhcpd.conf . Ici, nous ajoutons une entrée d'hôte en dhcp-edit(8) la commande dhcp-edit(8) . Ici, vous devez remplacer 01: 02: 03: AB: CD: EF avec le MAC que vous avez trouvé.

 # dhcp-edit demohost 01:02:03:AB:CD:EF 

Après avoir appelé cette commande, c'est ce que l'entrée hôte dans dhcpd.conf ressemblera à:

 host demohost {hardware ethernet 01:02:03:AB:CD:EF;fixed-address demohost;} 

TFTP

Normalement, vous n'avez pas besoin d'apporter de modifications à la configuration dameon TFTP. Les fichiers fournis par TFTP sont situés dans / srv / tftp / fai .
NFS

La commande fai-setup a déjà configuré le démon NFS et ajouté quelques lignes au fichier de configuration / etc / exports . Il exporte les répertoires en utilisant NFS v3.
Création de la configuration PXELINUX

La dernière étape avant de démarrer votre client pour la première fois est de spécifier quelle configuration le client doit démarrer lors de l'amorçage PXE. Nous fai-chboot(8) la commande fai-chboot(8) pour créer une configuration pxelinux pour chaque client d'installation. Cela comprend des informations sur le noyau, l'initrd, l'espace de configuration et certains paramètres d'amorçage. Vous devriez lire la page de manuel, qui vous donne quelques bons exemples. Voici la commande pour démarrer l'installation de l'hôte demohost.

$ fai-chboot -IFv -u nfs://faiserver/srv/fai/config demohost
Booting kernel vmlinuz-3.16.0-4-amd64
 append initrd=initrd.img-3.16.0-4-amd64 ip=dhcp
   FAI_FLAGS=verbose,sshd,createvt
   FAI_CONFIG_SRC=nfs://faiserver/srv/fai/config

demohost has 192.168.33.100 in hex C0A82164
Writing file /srv/tftp/fai/pxelinux.cfg/C0A82164 for demohost

À ce stade, vous devriez avoir une configuration faiserver de travail et vos clients devraient démarrer dans FAI et être en mesure d'installer l'un des exemples.

Dans la section suivante, vous pouvez lire la planification de votre installation, adapter votre espace de configuration à vos besoins particuliers et étendre FAI à l'aide de crochets.
Serveur personnalisé

Le faiseur et sa configuration n'est nullement statique. Il est possible de personnaliser et d'étendre votre serveur. Pour cela, reportez-vous à la section [Personnalisation de votre installation du serveur d'installation] dans [avancé] .

Planifiez votre installation

Avant de commencer votre installation, vous devriez investir beaucoup de temps dans la planification de votre installation. Une fois que vous êtes satisfait de votre concept d'installation, FAI peut faire toutes les tâches ennuyeuses et répétitives pour transformer vos plans en réalité. FAI ne peut pas faire de bonnes installations si votre concept est imparfait ou manque de quelques détails importants. Commencez à planifier l'installation en répondant aux questions suivantes:

    Est-ce que je vais créer un cluster Beowulf ou dois-je installer des machines de bureau?

    À quoi ressemble ma topologie LAN?

    Ai-je un matériel uniforme? Le matériel sera-t-il uniforme à l'avenir?

    Le matériel a-t-il besoin d'un noyau spécial?

    Comment nommer les hôtes?

    Comment les disques durs locaux doivent-ils être partitionnés?

    Quelles applications seront gérées par les utilisateurs?

    Les utilisateurs ont-ils besoin d'un système de mise en file d'attente?

    Quel logiciel doit être installé?

    Quels démons devraient être lancés, et à quoi devrait ressembler la configuration?

    Quels systèmes de fichiers distants doivent être montés?

    Comment effectuer les sauvegardes? 

Vous devez également penser à des comptes d'utilisateur, des imprimantes, un système de courrier, des travaux de cron, des cartes graphiques, l'initialisation double, le NIS, le NTP, le fuseau horaire, la disposition de clavier, l'exportation et le montage des annuaires via NFS et beaucoup d'autres choses. Donc, il ya beaucoup à faire avant de commencer une installation. Et rappelez-vous que la connaissance est le pouvoir, et c'est à vous de l'utiliser. L'installation et l'administration sont un processus et non un produit. La FAI ne peut pas faire les choses que vous ne lui dites pas de faire.

Mais vous ne devez pas commencer à partir de zéro. Examinez les fichiers et les scripts dans l'espace de configuration. Il ya beaucoup de choses que vous pouvez utiliser pour votre propre installation. Un bon article intitulé «Bootstrapping a Infrastructure» avec d'autres aspects de la construction d'une infrastructure est disponible sur http://www.infrastructures.org/papers/bootstrap/bootstrap.html
L'espace de configuration et ses sous-répertoires

L'espace de configuration est la collection d'informations sur la façon exacte d'installer un client. L'espace de configuration central pour tous les clients d'installation se trouve sur le serveur d'installation dans / srv / fai / config et ses sous-répertoires. Cela sera monté par les clients d'installation dans / var / lib / fai / config . La commande d'installation principale fai(8) utilise tous ces sous-répertoires dans l'ordre indiqué sauf pour les crochets.

classe/

    Scripts et fichiers pour définir des classes et des variables. 
Disk_config /

    Fichiers de configuration pour partitionnement de disque, RAID logiciel, LVM et création de système de fichiers. 
Basefiles /

    Normalement , le fichier base.tar.xz (situé à l' intérieur du nfsroot) est extrait sur le client d'installation après la création des nouveaux systèmes de fichiers et avant l'installation du package. Il s'agit d'une image de base minimale, créée juste après avoir appelé debootstrap lors de la création du nfsroot sur le serveur d'installation. Si vous voulez installer une autre distribution que la nfsroot, vous pouvez mettre un fichier tar dans le sous-répertoire basefiles / et le nommer après une classe. Ensuite, la commande ftar(8) est utilisée pour extraire le fichier tar en fonction des classes définies. Ainsi, le fichier doit être nommé CLASS.tar.xz et non CLASS.base.tar.xz . Cela se fait dans la tâche extrbase . Utilisez cette option si vous souhaitez installer une autre distribution ou une version différente de celle exécutée pendant l'installation.

    Ce fichier de base peut également être reçu en fonction des classes FAI via HTTP ou FTP en définissant la variable FAI_BASEFILEURL. FAI téléchargera un fichier CLASSNAME.tar.xz (ou tgz, ou tar.gz, ...) à partir de cette URL, si CLASSNAME correspond à une classe FAI.

    Exemple: 

 FAI_BASEFILEURL=http://fai-project.org/download/basefiles 

Le dossier doit prendre en charge la liste des répertoires. FAI ne recherchera pas de fichiers potentiellement correspondants.

Voir le chapitre [otherdists] pour savoir comment installer différentes distributions.

Debconf /

    Ce répertoire contient toutes les données debconf(7) . Le format est le même que celui utilisé par debconf-set-selections(8) . 
Package_config /

    Les fichiers contenant des noms de classe contiennent des listes de progiciels à installer ou à install_packages(8) par install_packages(8) . Les fichiers nommés <CLASS> .asc sont ajoutés à la liste des clés utilisées par apt (à l'aide d' apt-key(8) ) pour les dépôts de paquets approuvés. 
Scripts /

    Scripts pour la personnalisation de votre site local. Utilisé par fai-do-scripts(1) . 
des dossiers/

    Fichiers utilisés par les scripts de personnalisation. La plupart des fichiers se trouvent dans une structure de sous-arborescence qui reflète l'arborescence de répertoires ordinaire. Par exemple, les modèles de nsswitch.conf se trouvent dans $ FAI / files / etc / nsswitch.conf et sont nommés en fonction des classes auxquelles ils doivent correspondre: $ FAI / files / etc / nsswitch.conf / NIS est la version de /etc/nsswitch.conf à utiliser pour la classe NIS. Notez que le contenu du répertoire des fichiers n'est pas automatiquement copié sur la machine cible, mais qu'il doit être explicitement copié par des scripts de personnalisation à l'aide de la fcopy(8) . 
Crochets

    Les crochets sont des programmes ou des scripts définis par l'utilisateur, qui sont appelés pendant le processus d'installation. Le peut étendre ou remplacer les tâches par défaut. Le nom du fichier doit être de format taskname.CLASSNAME [.sh] . Un hook appelé updatebase.DEBIAN est exécuté avant la mise à jour de la tâche et updatebase si le client d' updatebase à la classe DEBIAN. 

Définition des classes

Il existe différentes possibilités pour définir des classes:

    Certaines classes par défaut sont définies pour chaque hôte: DEFAULT, LAST et son nom d'hôte.

    Les classes peuvent être répertoriées dans un fichier.

    Les classes peuvent être dynamiquement définies par des scripts. 

La dernière option est une fonctionnalité très intéressante, puisque ces scripts définiront des classes est un moyen très flexible. Par exemple, plusieurs classes peuvent être définies uniquement si certains matériels sont identifiés ou si une classe est définie en fonction des informations de sous-réseau du réseau.

Tous les noms de classes, sauf le nom d'hôte, sont écrits en majuscules.ILs pas ne la doivent contain non trait d'union, hachage non, non Point-Virgule OÜ point de non, but PEUVENT contain des characters de soulignement et des Chiffres.

La Tache defclass Appelle la commande fai-class(1)versez definir les classes. Directeur Tous les scripts correspondant ^ [0-9] [0-9] * (ILS Commencent Avec Deux Chiffres) Dans le sous - REPERTOIRE $ FAI / Classe exécutées de definir des Sont verser classes. Tout ce qui is imprimé à STDOUT is automatiquement definie Comme une classe. Versez Plus d ' informations sur La Classe définissant, Read les pages de manuel versent fai-class(1). Le manuscrit 50-host-cours (voir ci - juin dessous la version allégée) is used versez les définir des classes en fonction du nom d'hôte.

 # use a list of classes for our demo machines case $HOSTNAME in demohost) echo "FAIBASE GRUB DHCPC DEMO" ;; xfcehost) echo "FAIBASE GRUB DHCPC DEMO XORG XFCE";; faiserver) echo "FAIBASE DEBIAN DHCPC DEMO FAISERVER" ;; *) echo "FAIBASE GRUB DHCPC" ;; esac 

Les EMNO d'hôtes doivent Rarement Être UTILISE Pour Les Fichiers de configuration dans l'Espace de configuration. Au lieu de l' ACDE, juin classe Doit Être definie et ensuite added Pour un hôte Donne. En effet, la Plupart du Temps les Données de configuration ne pas are Spécifiques d'ONU hôte, but can be shared Entre several hôtes.

L'ordre des catégories is voiture Important Elle Définit la priority des cours de Faible à Élevé.
Définition des Variables

La Tache defvar definit les Variables Pour l'installation de du client. Les Variables Sont définies nominale des scripts Dans la classe / *. Var . Toutes les Variables Globales PEUVENT Être définies Dans DEFAULT.var . Verser CERTAINS GROUPES d'hôtes UTILISER UN Fichier de classe ous Pour un seul hôte UTILISER le Fichier $HOSTNAME .var . Ici also, il is utile d'Étudier Tous les exemples.

Les Suivantes des variables are utilisées Dans les exemples et PEUVENT also Être UTILES verser installation your:

FAI_ACTION

    Réglez le FAI d'actions Doït éffectuer. Normalement, l' ACDE se fait par fai-chboot(8). Si vous ne can PAS UTILISER this commande, définir la variable this à savoir in the scénario LAST.var .
FAI_ALLOW_UNSIGNED

    Si sur 1 definition, FAI Permet l'installation de de paquets à partir de référentiels non Signés. 
CONSOLEFONT

    La police de Qui est chargée LORs de l ' parités d'installation setfont(8).
KEYMAP

    Définit les Fichiers de mappage du clavier Dans / usr / share / keymaps et $ FAI / Fichiers . Vous ne Devez pas le chemin complet spécificateur, PUISQUE CE SERA Initiation automatiquement localisé.
rootpw

    Le mot de passe root crypté for the nouveau system. You can UTILISER crypt(3), md5 et d ' Autres types de hachage versez le mot de passe. Utilisez mkpasswd(1)versez le hachage Créer Pour un certain mot de passe. Par exemple, versez Générer hachage MD5 non verser l'utilisation du mot de passe

 $ echo "yoursecrectpassword" | mkpasswd -Hmd5 -s 

UTC

    Réglez l ' horloge du matériel à UTC si UTC = yes . Sinon, Regler l ' horloge à l' heure locale. Voir clock(8)verser en plus 'd informations.
FUSEAU HORAIRE

    Est -ce le Initiation par rapport à / usr / share / zoneinfo / Qui Indique Votre fuseau horaire. Par exemple: TIMEZONE = Europe / Berlin . _ 
MODULESLIST

    Une liste des modules DU Noyau Qui sont Chargés pendentif Le démarrage du nouveau systême (Écrit / etc / modules). 

Configuration du disque dur

L'outil setup-storage(8)allumé non Initiation Dans $ FAI / disk_config versez la configuration du disque. Ce commentaire Initiation decrit Tous les disques Locaux Divisés will be, rapide Quels types de Systèmes de Fichiers doivent Être CRIS (Comme ext3 / 4, XFS, btrfs), et where are ILS Montés sur. You can also Créer le RAID logiciel et les configurations LVM en Utilisant le Fichier de configuration. Il Est also possible de la mise en Conserver la page de disque Ou de les conserver Les Donnees - sur CERTAINES cloisons.

Pendant le Processus d ' installation de Tous les Systèmes de Fichiers Locaux Sont Montés par rapport à / cible . Par exemple, si vous Specifiez le Point de montage / home Dans un Fichier de configuration de disque, sérums this le répertoire / target / home pendant le Processus d'installation de und deviendra / home for the nouveau system Installé.
Initiation de la base Extrait
Debconf préconfiguration
L'Accès au dépôt de paquetages
configuration du progiciel

Avant l ' installation de de paquets, FAI va ajouter le contenu de Tous les Fichiers nommés package_config / class.asc à la liste des clés apt. Locale is signé par your keyid AB12CD34 vous can Facilement ajouter this clé, Fait FAI allez l 'de Si Votre UTILISER pendant l' installation. Utilisez this commande versez le Créer CLASS.asc fichier:

 faiserver$ gpg -a --export AB12CD34 > /srv/fai/config/package_config/MYCLASS.asc 

Le script de install_packages(8)Installe les Logiciels Sélectionnés. Il alluma Tous les Fichiers de configuration Dans $ FAI / package_config Dont le nom correspond à juin classe definie. La syntaxe est tres simple.

 # an example package class PACKAGES taskinst german PACKAGES aptitude adduser netstd ae less passwd PACKAGES remove gpm xdm PACKAGES aptitude GRUB lilo- grub 

Commentaires Commencent Dièse non par (N °) et se terminent à la fin de la ligne. Chaqué commande de paquetage commence par Le mot FORFAITS Suivi par non nom de commande, CE Qui correspond à l' ONU outil de package Comme différent apt-get, aptitude ous yum verser par exemple les Définit de commande Qui commandent will be UTILISE verser installateur les paquets nommés après this commande. La liste de Toutes Les Commandes DISPONIBLES PEUVENT Être en répertoires Utilisant install_packages -H . Outils versez les paquets pris en charges are: aptitude, apt-get, intelligent, yast, yum, rpm, zypper

tenir

    METTEZ non paquet en attente. Ce Paquet Pas ne SERA pris en charges par dpkg, pas de pair exemple mis à niveau.
installer

    Installez Tous les paquets (utilisation apt-get) Qui sont Précise DANS LES lignes Suivantes. Si non tiret is added au nom du paquet (sans espace intermédiaire), le paquet sérums supprimé, pas Installé. Tous les Noms de paquets Sont vérifiées verser les fautes d ' orthographe. Tout colis Qui Ne existe pas, sérums Retiré de la liste des paquets à l' installateur. SOYEZ DonC prudentes de NE Pas orthographier les Noms de paquets.
install-norec

    Comme installateur, but sans installateur les paquets recommandés. 
retirer

    Supprimer Tous les paquets Qui sont PRECISE DANS LES lignes Suivantes. Annexer un + au nom du paquet si le paquet Doit Être Installé.
taskinst

    Installez Tous les paquets Appartenant aux Tâches Qui sont spécifiées DANS LES lignes Suivantes à l ' aide tasksel(1). You can also UTILISER aptitude verser installateur des Tâches.
aptitude

    Installez Tous les paquets Avec la commande aptitude. Ce sérum la Valeur par défaut à l'avenir et may Remplacer apt-get et taskinst. Aptitudes may also installateur des paquets de Tâches.
aptitude-r

    Idem aptitude with l ' option de --with-recommande .
déballer

    Package Télécharger et décompressez only. Ne pas le configurateur package.
dselect-upgrade

    Definir les sélections de paquets en Utilisant les lignes Suivantes et installateur ous les supprimer paquets PRECISE. CES LIGNES SONT Le Résultat De La commande dpkg --get-selections . Il is recommandé de ne PAS UTILISER format ce, PUISQUE vous ÊTES also Specifiez Tous les paquets Qui ne are installés en raison d'Une dépendance ous recommande. Il Vaut Mieux Juste pour le spécificateur pacakge vous avoir, et de laisser FAI (et apt-get) RESOLV les dépendances.

Several Lignes Avec Des désignées particulières le pair de de Noms des espaces de paquets suivent les Lignes FORFAITS. Toutes les dépendances are résolues. Forfaits Avec le suffixe - (. Par exemple lilo- ) will be supprimés au lieu d'installation. L'ordre des paquets is peu importe. Si vous souhaitez installateur des paquets d 'Une Autre Version Que Celle par défaut, vous can ajouter le nom de la version au nom du paquet comme dans un openoffice.org/etch-backports . You can also Version spécificateur juin de Certaine Comme apt = 0.3.1 . Plus d ' bureaux informations - sur Fonctionnalités are décrites Dans aptitude(8).

Une ligne Qui contient les PRELOADRM Commandes, non à Initiation Télécharge l ' aide wget(1)Dans un répertoire avant d' installation les paquets. Utilisation du fichier: URL, this is Initiation COPIE à partir $FAI_ROOTdu répertoire de Téléchargement. Par exemple, le paquet a realplayerBesoin d ' archive juin verser installateur le logiciel, this is archive téléchargée in the folder / root . Après Avoir les paquets Installé CE SERA Initiation supprimé. Si le Fichier ne pas Doit Être à la retraite, utilisez la commande précharge lieu.

Il Est possible d'ajouter juin Liste de Noms de cours après la commande verser apt-get. Fait, CE FORFAIT commande ne SERA exécutée when la classe Correspondante is definie. AINSI, vous can combinateur several petits Fichiers in the Initiation DEFAULT. ATTENTION!Utilisez this fonction in the UNIQUEMENT Initiation DEFAULT verser keep vantent simple. Voir ce Fichier pour Quelques exemples.

Si vous souhaitez supprimer non nom de package à partir d'Une certaine classe faisait partie of this classe avant, vous ne devriez pas supprimer le nom du package à partir du Fichier de classe, Mais ajoutez tiret non (-) à Elle. Cela féra en Sorte Que le paquet is Retirer Pendentif juin Softupdate sur les hôtes Qui were installés à l'aide de la définition de classe ancienne Qui comprenait this nom de package.

Si vous Specifiez non package Qui pas de EXISTE this paquet sérums supprimé automatiquement à partir de la liste d'installation de la commande si UNIQUEMENT d ' une installation is Utilisée.
scripts de personnalisation

La commande fai-do-scripts(1)est Couleur appelee verser Executer TOUS les scripts Dans ce répertoire. Si non Repertoire with a nom de classe exists, Tous les scripts correspondant ^ [0-9] [0-9] * are Exécute Dans l ' ordre alphabétique. Il is possible d'Fait des UTILISER scripts de Langues Différentes (shell, cfengine, Perl, Python, Ruby, Attendez, ..) POUR UNE classe.

Thoses scripts écrivent their vers sortie DIFFERENTS aux fichiers journaux, en fonction du type de de script. Pour exemple, TOUS les scripts shell écrivent their Journal pour shell.log.
Les scripts shell

La Plupart des scripts shell scripts Bourne are. Les scripts shell UTILES SONT SI LA TACHE de configuration NE DOIT APPELER des Commandes shell ous Créer un Fichier à partir de zéro. AFIN de NE Pas ECRIRE de Nombreux scripts courts, il is possible d'UTILISER la ifclasscommande versez testeur si CERTAINES classes définies Sont.

 ifclass -o ABC 

verifie si l ' Une des classes A, B ou C définies de Sont. Utilisation -a Contrôles (logique) si toutes ses les catégories de la liste are définies. La commande ifclass C verifie si C est Seule classe definie.

Verser copieur des FICHIERS Avec Des cours, utilisez la commande fcopy(8). Si vous Voulez Extraire l' archive en juin Utilisant des cours, utilisez ftar(8). Verser annexant à lignes Une utilisation du Fichier de configuration au ainsl(1)lieu de simplement echo string >> filename.

FAI Soutient also zsh (1) scripts pendant la tache de personnalisation. Dans Les scripts, la variable de $classescontains non espace liste séparée Avec les NOMS de Toutes les catégories définies.
scripts cfengine

CFEngine Possède ONU Riche ensemble de fonctions verser les modificateur aux fichiers de configuration existants de, par exemple LocateLineMatching, ReplaceAll, InsèreLigne, AppendIfNoSuchLine, HashCommentLinesContaining . IL NE PEUT par Mais Pas Gerer des Variables Qui ne Sont Pas définies. Si variable juin is indéfinie, l'ensemble du scénario cfengine annulerait.

Plus d ' informations PEUVENT Être trouvées Dans la page de manuel cfengine(8)OÜ à la page d' accueil de cfengine http://www.cfengine.org .
Crochets

Crochets vous permettent de Prescription des fonctions ous des programmes Qui sont Exécute une CERTAINES Etapes du Processus d'installation. Avant Qu'une Tâche is appelee, FAI recherche crochets existants versez this Tâche et les exécuter. Comme sur Pouvait S'y Attendre, les catégories Sont also utilisées LORs de l ' Appel des crochets. Les crochets de Exécute Sont verser each classe definie. Il vous Suffit de le crochet Créer Avec le nom de la classe désirée et il sérums used. Si Drogues illicites croches verser une tache exists, ILS SONT appeles DANS L'Ordre definition Par les classes. Si debug is Inclus dans $FAI_FLAGl'option de -d is transmise à tous les crochets, de Sorte Que vous can déboguer Vos Propres crochets. Si par défaut CERTAINES Tâches doivent Être Ignore, utilisez le sous - programme skiptask et juin Liste de Tâches par défaut en Tant que paramêtres. Dans les exemples Fournis, les crochets de la classe CentOS CERTAINES sauteuses TACHES Spécifiques à Debian.

Le Repertoire $ FAI / crochets / Contains TOUS les crochets. Un crochet is a Fichier exécutable suivant le schéma de nommage taskname.CLASSNAME [.sh] (par exemple des repository.CENTOS ous savelog.LAST.sh), ONU nom de Tâche et non nom de par le point de non classe, SUIVIE par Eventuellement ".sh . Le nom de la Tâche Précise Qui tache de faire précéder l ' exécution de CE crochet, si la classe spécifiée is definie versez le client d'installation. Voir la section [Tâches] Pour Une liste complète des Tâches par défaut Qui can be used.

Un crochet de la forme hookprefix.classname ne may pas définir des Variables Pour le scénario d'installation, voiture il sous is a - Processus. Mais vous can UTILISER l ' exécutable binaire OÜ manuscrit non Que you have Écrit. Crochets Qui Ont le suffixe .sh (par exemple «partition.DEFAULT.sh) scripts doivent être Des shell Bourne et are sources. Il is possible de redéfinir Fait les les variables versent les scripts d'installation.

Dans la première partie de la FAI, Tous les Crochets with the Préfixe confdir are appeles. CEs ne PEUVENT crochets Être Localisés dans l'Espace de configuration, pas encore Puisqu'il is available. Par Conséquent, bureaux crochets are les Crochets Seuls Situés Dans $nfsroot / $ FAI / Crochets sur le serveur d ' installation. Tous les Autres Crochets se trouvent Dans $ FAI_CONFIGDIR / hooks sur le serveur d ' installation.

Tous les crochets Qui sont appeles Avant que les catégories NE SONT définies Qué PEUVENT UTILISER les catégories Suivantes: DEFAULT $ HOSTNAME LAST . Si non crochet versez la classe DEFAULT ne obole Être Appelé si Aucun crochet versez la classe $HOSTNAMEis available, insérez bureaux Lignes in the crochet par défaut:

 hookexample.DEFAULT: #! /bin/sh # skip DEFAULT hook if a hook for $HOSTNAME exists scriptname=$(basename $0 .DEFAULT) [-f $FAI/hooks/$scriptname.$HOSTNAME ] && exit # here follows the actions for class DEFAULT . . 

Quelques exemples de Ce que les crochets PEUVENT Être UTILISE:

    Les modules du noyau de charger avant les catégories Sont définies Dans $ FAI / classe .

    Envoyer email non à l'administrateur si l'installation de is Terminée.

    Installez sans client de l'ONU et disque EVITER le partitionnement de disque local.

    Jetez Un oeil sur l' hooks/debconf.IMAGEimage de savoir Utilisant de juin commentaire Cloner machine à juin verser de Système de Fichiers.

FAI drapeaux

La variable de $FAI_FLAGScontains juin liste d'espace séparé des drapeaux. Les drapeaux Suivants Sont connus:

verbeux

    Créer juin sortie verbeuse LORs de l'installation. Cela devrait Toujours Être le premier drapeau, de Sorte Qué les définitions des options de verbeusement will be affichées.
déboguer

    Créer sortie de débogage. Aucune installation de éffectuée automatique is. Pendant l'installation de du package, vous Devez Répondre à des questions des Toutes Les scripts de poste sur la console du client. Un grand Nombre de postes d'Informations de débogage sérums imprimé. Ce drapeau is only utile versez les developpeurs FAI.
sshd

    Demarrez le démon ssh versez les permettre connexions Ë la distance. You can ensuite vous connecteur en im- racine à tous les clients à l' installateur LORs de l'installation. Le mot de passe par défaut is fai et can be Modifié par la mise FAI_ROOTPWen nfsroot.conf(5). Pour vous connecteur à partir de Votre serveur au client d ' installation (demohost Nommé Dans this exemple) UTILISER:

 $ ssh root@demohost Warning: Permanently added 'demohost,192.168.33.100' to the list of known hosts. root@demohost's password: 

Céci Est only Le mot de LORs racine Passe du Processus d'installation, pas verser le nouveau system Installé. You can also vous CONNECTER sans non mot de LORs Passe de l ' utilisation $SSH_IDENTITY.

createvt

    Créer Deux Terminaux Virtuels et exécuteur non bash si ctrl-c is in the tapé borne de la console. Les bornes supplementaires en Tapant are accessibles Alt-F2 ous Alt-F3 . Dans le CAS Contraire, Aucun des Terminaux is available et en Tapant ctrl-c redémarrera le client d ' installation. La définition de this is drapeau utile versez le débogage. Si l' installation de juin vous de Voulez Qui ne devrait pas Être interruptible, pas ne la réglez CE drapeau.
menu

    Cela Permet à Menu non d'Utilisateur verser selectionner profil non. Tous les Fichiers class/*.profileSont lus et non le menu malédictions sur la will be de base CRIS.
Redémarrer

    Redémarrez le when client l'installation de ESt sans de Terminée amincissent la console RETURN. Si this is drapeau pas definition, et error.log contains quoi Que this Soit, le client d' une installation va Arrêter et Attendre Que vous appuyez sur RETURN. Si Aucune erreur ne se Sont Produits, le sérum client Toujours Redémarrer automatiquement.
arrêt

    Arrêtez le client d'une installation à la fin de l'installation, au lieu de Redémarrer in the nouveau system. 
initiale

    UTILISE par setup-storage(8). Cloisons Marqués with preserve_reinstallare Conserves, option this is si Sauf en Activée. Souvent, Ce drapeau mis d'inté- Dans un Fichier de classe / *. Var en Utilisant la mise en flag_initial = 1 .

FAI Installe Votre régime
La première partie d'une installation de juin

Après Que le noyau d' un Demarre, il monte le Système de Fichiers racine par NFS DEPUIS le serveur d ' installation de et Démarre le script de / usr / sbin / fai
[PUISQUE le Système de Fichiers racine sur les clients is monté via NFS, faiis Situé Dans / srv / Fai / nfsroot / usr / sbin sur le serveur d ' installation.]
.Ce script Contrôle la séquence de l'installation. Pas d ' Autres scripts Dans /etc/init.d/ are UTILISE.

L'espace de configuration is available via la méthode configurée (montage NFS par défaut) à partir du serveur d ' installation de sur le chemin definition Dans $ FAI
[ $ FAI is a la variable interne Utilisée Par les scripts FAI. Par défaut, le chemin d ' accés is / var / lib / fai / config .]
messages de demarrage

LORs du demarrage d'une installation Du client de la carte réseau with PXE vous Aurez des messages Comme Celui-ci:

 Managed PC Boot Agent (MBA) v4.00 Pre-boot eXecution Environment (PXE) v2.00 DHCP MAC ADDR: 00 A2 A3 04 05 06 DHCP.../ CLIENT MAC ADDR: 00 A2 A3 04 05 06 GUID: 3D6C4552 CLIENT IP: 192.168.33.100 MASK: 255.255.255.0 DHCP IP: 192.168.33.250 GATEWAY IP: 192.168.33.1 !PXE entry point found (we hope) at 9854:0106 via plan A UNDI code segment at: 9854 len 5260 UNDI data segment at: 921D len 63A2 Getting cached packet 01 02 03 My Ip address seems to be C0A82164 192.168.33.100 ip=192.168.33.100:192.168.33.250:192.168.33.1:255.255.255.0 BOOTIF=01-00-A2-A3-04-05-06 SYSUUID= TFTP prefix: fai/ Trying to load pxelinux.cfg/C0A82164 Loading vmlinuz-3.16.0-4-amd64.................. Loading initrd.img-3.16.0-4-amd64......................ready. 

À CE stade, le client d ' installation , un received with succès la configuration du réseau via DHCP et le noyau et initrd via TFTP. Il Démarre le noyau Linux Maintenant et initrd. Si tout se passe bien, l'initrd monte le nfsroot
[ / srv / fai nfsroot / du serveur d ' installation via NFS]
et les scripts FAI are Lances. La première a choisi Que vous Voyez is le message de FAI du droit d'auteur rouge.

  ------------------------------------------------- Fully Automatic Installation - FAI 5.3.3~bpo8+2 (c) 1999-2017 Thomas Lange <lange@informatik.uni-koeln.de> ------------------------------------------------- Calling task_confdir Kernel currently running: Linux 3.16.0-4-amd64 x86_64 GNU/Linux Kernel parameters: BOOT_IMAGE=vmlinuz-3.16.0-4-amd64 initrd=initrd.img-3.16.0-4-amd64 \ rw aufs ip=dhcp root=192.168.33.250:/srv/fai/nfsroot FAI_FLAGS=verbose,sshd,createvt\ FAI_CONFIG_SRC=nfs://faiserver/srv/fai/cskoeln FAI_ACTION=install quiet\ BOOTIF=01-00-a2-a3-04-05-06 Reading /tmp/fai/boot.log FAI_FLAGS: verbose sshd createvt Setting SERVER=faiserver. Value extracted from FAI_CONFIG_SRC. FAI_CONFIG_SRC is set to nfs://faiserver/srv/fai/config Configuration space faiserver:/srv/fai/config mounted to /var/lib/fai/config Calling task_setup FAI_FLAGS: verbose sshd createvt 15 Jan 13:22:37 ntpdate[1533]: step time server 192.168.33.250 offset -0.342793 sec Press ctrl-c to interrupt FAI and to get a shell Starting FAI execution - 20170115_132237 Calling task_defclass fai-class: Defining classes. Executing /var/lib/fai/config/class/10-base-classes. 10-base-classes OK. Executing /var/lib/fai/config/class/20-hwdetect.source. Loading kernel module md-mod 20-hwdetect.source OK. Executing /var/lib/fai/config/class/50-host-classes. 50-host-classes OK. List of all classes: DEFAULT LINUX AMD64 FAIBASE DHCPC DEMO GRUB client01 LAST 

You can also consulter la liste des classes de FAI, Qui sont Definis verser this hôte. This is liste très importante versez le Reste de l'installation.

La première Tâche is appelee confdir , Qui est responsable d'get l ' accès à l ' espace de configuration. Ici, utilisons NOUS montage non NFS à partir du serveur d ' installation de est comme vous le can voir sur la console (et plus tard DANS LES journaux).

 FAI_CONFIG_SRC is set to nfs://faiserver/srv/fai/config Configuration space faiserver:/srv/fai/config mounted to /var/lib/fai/config 

Avant de Commencer l'Installation ( $FAI_ACTION=install) l'ordinateur Emet Trois fois. Alors, SOYEZ prudent when vous Entendez trois bips, Mais vous Ne voulez installation de juin éffectuer de pas et laissez FAI effacer Toutes Les Données yout sur le disque locale!
Redémarrer l'ordinateur Dans le nouveau system

Verser Redémarrer pendentif l'ordinateur de ous à la fin de l'installation, vous Devez UTILISER la commande fairebooten Faveur de la commande de Redémarrage normal. Utilisez fairebootalso si Connecté à la distance. Si l'installation n'à pas fini, utilisez faireboot -s , de Sorte Que les Fichiers JOURNAUX are also COPIES sur le serveur d ' installation.

Si l'installation de Terminée is with succès, l'ordinateur devrait demarrer Un petit system Debian. You can vous en connecteur Tant qu'utilisateur démo ous root with mot de passe fai .
DEMARRAGE FAI (Tâche confdir)

Après l'installation de du client un Démarre le script de only / usr / sbin / Fai is exécutée. Il fera juin initialisation minimale. La variable de $FAI_CONFIG_SRC
[Il a definition sur la ligne de commande du noyau]
is used versez Avoir accès à l ' espace de configuration de FAI Qui est Alors available in le répertoire $FAI
[/ var / lib / fai / config]
. FAI ne procèdera pas sans l'espace de configuration.
Définition Les classes d 'ET de variables (Tâches defclass et defvar)

La commande fai-class(1)Exécuter des scripts Dans $ FAI / classe versez definir des classes. Si les scripts écrivent juin chaîne à stdout, sérums this Comme definition juin classe. Read Tous les détails Dans la page de manuel de fai-class(1).

Après les cours Avoir definition, Tous les Fichiers correspondant à .var with a Préfixe Qui correspondent à UNE Classe definie provient de definir des Variables. Elle Doït contain non le code shell vaild.
Partitionner les disques Locaux, la création de Systèmes de Fichiers (partition de Tâche)

Pour le partitionnement du disque de fichier de configuration d Exactement ' non disque à partir de $ FAI / disk_config Est selectionné en Utilisant les classes.

Le Format de la configuration du disque is Similaire à l'ONU Initiation fstab.

L'outil de partitionnement setup-storage(8)exécutons Toutes les Commandes nécéssaires à la création de la partition de disque mise en page le logiciel RAID, LVM et versez Créer les Systèmes de Fichiers. Read la page de manuel setup-storage(8)verser Description juin DÉTAILLÉE et des exemples du formatage.
Debconf préconfiguration (Tâche debconf)

Fichiers de $ FAI / debconf are UTILISE verser l'habituel debconf(7)presseding si les Noms de Fichiers correspondant à non nom de classe.
Installation des paquets que de Logiciels (Tâche instsoft)

La commande install_packages(8)allumé les Fichiers de configuration à partir de $ FAI / package_config de Manière à la base de classe et Installe des Logiciels sur le nouveau Système de Fichiers.

Il Installe les paquets en Utilisant apt-get(8), aptitude(1), yumous d ' Autres outils de l' emballage sans Aucune interaction manuelle Nécessaire. Dependecies de l ' emballage are also par les outils résolus de l' emballage.

Format Le des Fichiers de configuration is decrit Dans [packageconfig] .
Spécifique personnalisation du site (Tâche configure)

Souvent, les configurations par défaut des Logiciels ne pas répondre à will be Vos Website Spécifiques needs. You can Appeler des scripts arbitraires Qui ajustent la configuration du system. Par Conséquent, La commande fai-do-scripts(1)Exécuter des scripts Dans $ FAI / scripts de Manière à la base de classe. Il is possible d'Avoir PLUSIEURS scripts de Différents types (shell, cfengine, ...) Un exécuteur Pour Une classe.

L'ensemble de scripts par défaut Dans $ FAI / scripts incluent des exemples d ' installation de Debian ET machines CentOS. ILs Ont mis le mot de passe root, ajoutez un compte Tarifs d'Utilisateur de démonstration, réglez le fuseau horaire, le configurateur réseau DHCP verser ous en Utilisant juin fixe adresse IP, la configuration grub et plus encore. ILs devraient faire non travail reasonable verser installation your. You can les modificateur ous ajouter de Nouveaux scripts verser Répondre à Vos besoins Locaux.

Plus d ' scripts informations sur CES SONT décrits la DANS [cscripts] .
Enregistrement des Fichiers journaux (Tâche savelog)

When Toutes les Tâches are terminées, les FICHIERS Écrits journaux de Sont Dans / var / log / Fai / $ HOSTNAME / install /
[ / var / log / Fai / localhost / install / is un vers privilège ce répertoire.]
Sur le nouveau Système et de le compte sur le serveur d ' installation de si $LOGUSERis definition. Il is also possible de spécificateur Un autre hôte journal Comme destination Sauver à Travers la variable $LOGSERVER. Si $LOGSERVERNon défini, FAI utiliser la variable de $SERVERQui est only definition LORs de l'installation de Initiale (par get-boot-info). ASSURER - vous de définir $LOGSERVERDans un classe var / *. Script si vous utilisez l' une action Softupdate .

En outré, les privilèges Deux des Seront les CRIS verser le dernier indiquer folder Écrit. La symlink Dernières pointe vers le répertoire du journal de la Dernière mesure éffectuée FAI. Le liens symboliques d' installation Dernière et Dernière sysinfo pointez sur le répertoire with La Dernière mesure Correspondante. Par défaut les Fichiers JOURNAUX will be COPIES sur le serveur de la revue en Utilisant scp. You can UTILISER la grandeur $FAI_LOGPROTODans le Fichier fai.conf (5) versez Choisir juin Autre méthode verser ENREGISTRER les journaux sur le serveur distant. VOICI non exemple de la structure de de symlink:

 lrwxrwxrwx 1 fai fai 23 Dec 2 2013 last-sysinfo -> sysinfo-20131202_161237 drwxr-xr-x 2 fai fai 4096 Dec 2 2013 sysinfo-20131202_161237 drwxr-xr-x 2 fai fai 4096 Feb 14 2014 install-20140214_142150 drwxr-xr-x 2 fai fai 4096 Dec 2 11:47 install-20141202_113918 lrwxrwxrwx 1 fai fai 23 Dec 4 13:22 last-install -> install-20141204_131351 lrwxrwxrwx 1 fai fai 23 Dec 4 13:22 last -> install-20141204_131351 drwxr-xr-x 2 fai fai 4096 Dec 4 13:22 install-20141204_131351 

Des exemples de FICHIERS Journaux trouvés PEUVENT d'Être à http://fai-project.org/logs .
Redémarrer le nouveau system Installé

Avant de Redémarrer, le Qu'Appelle client installateur fai-chboot -d <hostname>sur le serveur d ' installation, de sa configuration Désactiver PXELINUX propre. Sinon, il Serait Redémarrer l'installation de LORs du demarrage Prochain. Normalement, l' ACDE devrait demarrer le nouveau system Installé à partir de fils second dispositif de demarrage, le disque dur local.

A la fin, le system is automatiquement redémarré si «reboot» was added à $FAI_FLAGS.
Sujets de FAI
Vérification des paramêtres des Reçus Serveurs DHCP

Si le client Démarre, vous can verify si Toutes Les informations Du DHCP démon are Reçus correctement. Les informations recues are Ecrites /tmp/fai/boot.log . Un exemple du Résultat D'une Requête DHCP can be found Dans les Fichiers journaux de l ' échantillon.
Surveillance des installations de clients multiples

You can Surveiller l'installation de de Tous les clients à l' installateur Avec la commande fai-monitor(8). Tous les clients de verify si this is en démon cours d ' exécution sur le serveur d' installation de (ou la machine à definie par la grandeur $monserver). Each foie Qu'une Tâche commence ous se Termine, un message non is Envoyé. Le moniteur FAI imprime démon messages de bureaux sur la norme de sortie. Il y a also juin Interface graphique disponible, Appelé fai-monitor-gui(1).

 $ fai-monitor | fai-monitor-gui - & 

La Collecte des adresses Ethernet verser PLUSIEURS hôtes

Vous Devez collecter toutes ses Ethernet (MAC) adresse des clients et assigner non nom d'hôte et l'adresse IP à each client. Pour collecter les Adresses MAC, l' installation de clients Vos. You can déjà le faire avant tout démon DHCP is en cours d'exécution Dans Votre sous-réseau. ILs ne parviennent pas à demarrer (à cause de du DHCP ous manquant TFTP manquant), Mais vous can Toujours recuperer les Adresses MAC.

Alors Que les clients de la phase de démarrage, ILS envoient des paquets de vers de diffusion le réseau local. You can vous les adresses MAC connecteur de bureaux hôtes en exécutant la commande suivante en same temps sur le serveur:

 faiserver# tcpdump -qtel broadcast and port bootpc >/tmp/mac.list 

Une Fois les hôtes were Envoyés des paquets de diffusion avortent tcpdumpen Tapant ctrl-c . Vous obtenez juin liste de Toutes Les adresses MAC uniques bureaux AVEC COMMANDES:

 faiserver$ perl -ane 'print "\U$F[0]\n"' /tmp/mac.list|sort|uniq 

Après ACDE, il SUFFIT D'bureaux de attribuer aux adresses NOMs d ' hôtes et les adresses IP ( / etc / ethers et / etc / hosts OÜ Cartes correspondantes NIS). Informations this Avec, vous can configurateur Votre DHCPdémon (voir la section [bootdhcp] ).
[Je recommande d'initiatives Écrire les MAC (Adresses Derniers de Trois octets suffiront si you have des cartes réseau du same provider) et le nom d'hôte à l'avant de each châssis.]
au inspector Point du trafic réseau

Si le Né client may est pas correctement demarrer à partir de la carte réseau, utilisez tcpdump(8)versez Chercher des paquets Ethernet Entre le serveur d ' installation de et le client. Recherchez also des entrées Dans several aux fichiers journaux Faits par tftpd(8)et dhcpd(8):

 faiserver$ egrep "tftpd|dhcpd" /var/log/* 

Détails de demarrage PXE

Nous décrivons ici les détails de demarrage PXE, Qui ne are Nécessaires si you have des Problèmes LORs du demarrage de Vos clients installateur.

Presque Toutes Les cartes réseau bootable modernes prennent en charges l'environnement d'initialisation PXE. PXE is the Preboot Execution Environment. Cela Nécessite le bootloader de PXELINUX et juin la version spéciale du TFTP daemon, Qui est available in les paquets Debian pxelinuxet tftpd-hpa. DEMARRAGE PXE a Besoin also d ' non serveur DHCP, de Sorte Que la carte réseau may configurateur SES paramêtres IP. Céci is the sequence d'ONU demarrage PXE:

    Carte réseau du client Envoie fils adresse MAC

    serveur DHCP Répond à la configuration IP verser le client

    Carte réseau configure IP

    Installez le client obtient le binaire pxelinux.0 via TFTP

    Obtenez le Fichier de configuration pxelinux.cfg / de C0A8210C via TFTP

    C0A8210C is l'adresse IP du client en hexadécimal

    This configuration contains le noyau, initrd et les paramêtres de ligne de commande du noyau supplementaires, CE QUI pair ETE created fai-chboot.

    Obtenez le noyau et initrd via TFTP. 

Exemple d'ONU Initiation pxelinux.cfg:

 default fai-generated label fai-generated kernel vmlinuz-3.16.0-4-amd64 append initrd=initrd.img-3.16.0-4-amd64 ip=dhcp root=/srv/fai/nfsroot aufs FAI_FLAGS=verbose,sshd,createvt FAI_CONFIG_SRC=nfs://faiserver/srv/fai/config FAI_ACTION=install 

Voir /usr/share/doc/syslinux/pxelinux.doc versez Obtenir des informations , plus détaillées sur PXELINUX. Il y a Un nouveau lpxelinux binaire Qui prennent also en charger le chargement du noyau et initrd via FTP ous HTTP. La commande fai-chboot (8) Prend en accusation this with the options -U .
Personnalisation de Votre configuration d'installation du serveur

    en plus rapide miroir local / package

    LOGUSER Différente

    root pw nfsroot intérieur locale 

La configuration verser le paquet FAI (pas les Données de configuration versez les clients installateur) is definie Dans fai.conf (5) . Les définitions Qui ne Sont utilisées Que versez le nfsroot Créer are Situés Dans nfsroot.conf (5) . Vérifiez les variables CES IMPORTANTES Dans nfsroot.conf avant d ' Appeler fai-setup ous fai-make-nfsroot .

FAI_DEBOOTSTRAP

    Construire le nfsroot utiliser le debootstrap de commande (8) `. Il a Besoin de l'emplacement d'ONU miroir Debian et le nom de la répartition (Wheezy, jessie, stretch, sid) versez le Lequel system Debian de la base devrait Être Construit. Ne PAS UTILISER de Différentes distributions ici et Dans /etc/fai/apt/sources.list . Cela va Créer un nfsroot cassé.
NFSROOT_ETC_HOSTS

    THIS variables Est uniquement Les NECESSAIRE SI les pas de clients n'ont Accès à non serveur DNS. This is added multiligne variables à / etc / hosts à l'intérieur du nfsroot. Ensuite, les clients PEUVENT Accéder à bureaux d'installation hôtes par sans NOM UTILISER DNS.

Le contenu de /etc/fai/apt/sources.list is used by the serveur d ' installation de et also par les clients. Si Votre serveur d ' installation , un several cartes réseau et les Différents EMNO d'hôte verser each carte (Comme versez serveur non Beowulf), utilisez le nom du serveur d' installation de Qui est Connu par les clients installateur.

Si VOUS AVEZ des Problèmes en cours d ' exécution fai-setup, ILS découlent généralement de CE fai-make-nfsroot(8)Qui est Appelé par l' de commandement ancien. Ajout de -v vous donne sortie de juin , plus verbeuse Qui vous aide à localiser l'erreur. La sortie is écrite /var/log/fai/fai-make-nfsroot.log .
[Pour le débogage, il may secouriste à Entrer dans l'environnement chroot manuellement à l ' aide de this commande. FAISERVER # chroot / srv / fai / nfsroot bash ]

Le programme d ' installation de Cris also le compte fai (par definition $LOGUSER) si non déjà disponible. AINSI, vous can ajouter non Utilisateur avant d ' Appeler à l' fai-setup(8)aide de la commande adduser(8)et de l ' UTILISER Comme Votre compte locale versez l' enregistrement des Fichiers journaux. Les FICHIERS journaux de Tous Les clients are sauvegardés in the folder d'accueil of this Compte. Vous Devez modificateur le groupe principale of this Compte, de Sorte Que CE Compte disposer des Autorisations d'écriture Dans / srv / tftp / fai verser Appeler fai-chboot verser Créer la configuration de PXE verser les hôtes.

When vous apportez des modifications A fai.conf , nfsroot.conf le nfsroot Doït Être en appellant reconstruit fai-make-nfsroot(8). Si vous versez installateur Aimez only Un nouveau paquet de noyau à la nfsroot ajouter les drapeaux -k ous -K à fai-make-nfsroot. Cé pas ne SERA récréer your nfsroot, but only a rencontré à jour Vos modules noyau et l ' intérieur du nfsroot ous ajouter des emballe supplementaires in the nfsroot.
CREATION D'UN CD ou FAI et clé USB

You can Facilement Créer un CD d'installation de (ou clé USB) de Votre configuration d'installation de réseau. Ceci effectuera la same l' installation et de configuration à partir du CD Sans Avoir Besoin du serveur d ' installation. Par Conséquent, vous Devez Créer un miroir partitial de Tous les paquets nécéssaires Debian verser classes Vos FAI (à l ' aide fai-mirror(1)). Ensuite, la commande fai-cd(8)va Mettre CE miroir, le nfsroot et l'espace de configuration sur CD amorçable non. C'est tout!

Ce CD d'installation de contains Toutes les Données nécéssaires à l'installation. La commande a fai-cd(8)rencontré le nfsroot, l'espace de configuration et sous un - ensemble du miroir Debian de CD-ROM non. Un miroir de paquet partiel is created en Utilisant la commande fai-mirror(1)Qui contient Tous Les paquets Qui sont UTILISE les classes de pair utilisées Dans Votre espace de configuration. Une image ISO échantillon is available at http://fai-project.org/fai-cd .

Utilisation de la commande, dd(1)vous can also Créer juin clé USB bootable bâton en écrivant simplement le contenu du Fichier ISO sur Votre clé USB (ici le bâton is / dev / sdf ).

  faiserver# dd if=fai-cd.iso of=/dev/sdf bs=1M 

Ce ne CD en direct du serveur d'installation.
Création VM images de disque à l'aide de FAI

Utilisation de la commande, fai-diskimage(8)vous can CREER images Linux de Disques de machines, Qui PEUVENT Être UTILISE Avec Une machine à KVM virtuelle Comme, VMware, VirtualBox OÜ un service non de cloud OpenStack Comme, GCE, EC2 et d ' Autres. Le Processus d'installation de exécutons Les Taches FAI normales sur une Image brute de disque. Après l'installation, vous can demarrer l'image disque et have A system de roulement. L'image de disque may also Être Converti en qcow2 le formatage.

  faiserver# export FAI_BASEFILEURL=http://fai-project.org/download/basefiles/ faiserver# fai-diskimage -u cloud3 -S 2G -cDEBIAN,JESSIE64,AMD64,FAIBASE,GRUB_PC,CLOUD,GCE disk.raw 

Créé le disk.raw de fichier Pour un hôte Appelé cloud3, with a petit ensemble de paquets Logiciels.

  # export FAI_BASEFILEURL=http://fai-project.org/download/basefiles/ # cl=DEFAULT,DHCPC,DEBIAN,AMD64,FAIBASE,GRUB_PC,UBUNTU,XENIAL,XENIAL64,XORG # fai-diskimage -v -u foobar -S5G -c$cl ubuntu.qcow2 

Cris image juin de disque Appelé ubuntu.qcow2 Pour Une Ubuntu 16.04 bureau with the nom d'hôte sur foobar definition.

Vous ne neet pas le configurateur nfsroot Quand seulement en Utilisant fai-diskimage. Mais VOUS AVEZ Besoin d ' ONU basefile Dans Votre espace de configuration. You can télécharger l' image de juin de base Debian à partir de http://fai-project.org/download/basefile et copiez - le Dans Votre espace de configuration. Si you have déjà mis en lieu le nfsroot vous can copieur le basefile Debian du nfsroot Dans Votre espace de configuration en Utilisant this commande:

  $ cp /srv/fai/nfsroot/var/tmp/base.tar.xz $ /srv/fai/config/basefiles/JESSIE64.tar.xz 

FAI Système de secours

Si vous définissez la variable de $FAI_ACTIONà sysinfo (pour, par exemple en Utilisant fai-chboot -S), le client ne pas SERA installateur nouveau A system, but de permettra recueillir beaucoup d'informations sur le system. Si vous définissez $FAI_ACTIONà l ' inventaire Que vous ne pourrez get juin informations matérielle Quelques - uns. CÉS actions Deux PEUVENT Être utilisées verser la FAI en Tant que system de secours.

Type de de ctrl-c verser get non shell ous utilisez Alt-F2 ous Alt-F3 et vous obtiendrez non terminal Autre de la console, si you have added createvt à $FAI_FLAGS.

Vous Avez Maintenant Linux A system en cours d ' exécution sur le client, sans le disque dur UTILISER local. Utilisez ACDE Comme un system de secours si Votre disque locale is endommagé ous l'ordinateur ne may pas demarrer correctement à partir du disque dur. Shell non de Vous et You can exécuteur Diverses Commandes ( dmesg, lsmod, df, lspci, ...). Regardez le Fichier Journal Dans / tmp / fai . Vous y trouverez beaucoup d ' informations sur le Processus de demarrage.

FAI monte Tous les Systèmes de Fichiers Qu'il Trouvé sur les disques en Locaux lecture Seule. Il vous Indique also sur la partition d ' ONU Initiation / etc / fstab exists. When table Seule de Système de fichier is found, les partitions are montées informations SELON this. Voici un exemple:

 demohost:~# df Filesystem 1K-blocks Used Available Use% Mounted on rootfs 4099064 414088 3645296 11% / 192.168.33.250:/srv/fai/nfsroot 3905600 410976 3454944 11% /live/image tmpfs 193464 3112 190352 2% /live/cow aufs 4099064 414088 3645296 11% / 192.168.33.250:/srv/fai/config 3905600 410976 3454944 11% /var/lib/fai/config /dev/sda1 241116 74519 154149 33% /target /dev/sda9 4364212 139888 4179988 4% /target/home /dev/sda7 553376 16840 536536 4% /target/tmp /dev/sda8 2221628 275936 1832840 14% /target/usr /dev/sda6 577096 172924 374856 32% /target/var 

This method can be Utilisée Comme environnement non de secours! Si vous Avez Besoin d ' A system de Fichiers with a Accès en lecture-écriture la UTILISER rwmountcommande:

 demohost# rwmount /target/home 

FAI sans NFS

Pour demarrer en FAI et la séquence Commencer D'sans installation UTILISER le protocole NFS. Vous Demarrez l'ordinateur client en Utilisant PXE comme d'habitude, de l' image Puis juin de recuperer le nfsroot du contenant via http.

image de juin Créer Verser, utilisez l'argument -S de fai-cd

 faiserver# fai-cd -S squash.img 

l'image Déplacer this to a folder à partir Duquel il can be Demandé via http (généralement UN ANNUAIRE désservi par le serveur)

Versez Demander Maintenant l'squashfs image, ajouter Ce Qui suit à la ligne de commande du noyau, par exemple Dans Votre Fichier de configuration pxelinux for the client.

 root=live:http://faiserver/cskoeln/squash.img 

Remplacez FAISERVER with the nom de domaine ous IP de la machine à de l'image Votre de courge Est servi à partir.
Installation d'Autres distributions Debian non nfsroot Utilisant

You can installateur toutes ses Sortes de distributions Linux à partir d ' Un seul nfsroot Debian. Par Conséquent, vous Devez Créer un base.tar.xz de la répartition Que vous souhaitez installateur et placer les informations du basefilesrépertoire. Puis nommez UBUNTU1404.tar.xz par exemple. Un client d ' installation de Qui Appartient à la UBUNTU1404 de classe extrait ensuite de CE Initiation de base Dans fils system de fichier vide. En outré, vous Devez les Ajuster sources.list FICHIERS ous de configuration Similaire Qui sont nécéssaires verser spécificateur l'emplacement du dépôt de paquetages.

L'outil rinse(8)is used for the création de la base de verser aux fichiers la répartition Comme CentOS, openSUSE, Scientific Linux Fedora ous Cern. CERTAINS basefiles PEUVENT Être téléchargés à partir de http://fai-project.org/download/basefiles/ .

Le scénario mk-basefileDans / usr / share / doc / fai-doc / exemples / simples / basefiles / aide la création de bureaux de Fichiers base.
Créer des Environnements chroot et virtualisation

Si vous Devez Créer des Environnements chroot, Ou non environnement de virtualisation where vous ne can ni Vouloir lancer non installateur Debian normale verser Accéder à A system de travail (par exemple, Xen Domaines Invités), il y a l'Action de FAI dirinstall . en appellant

 faiserver# fai <options> dirinstall <target-directory> 

et en Utilisant Soit l'option de -c <classe> ous -N vous obtenez l' installation de juin FAI, sans l'Action de partitionnement, à droite in the folder cible. Le nom d'hôte versez l'installation de cible can be specified en Utilisant -u <host-name>

Ceci, par exemple, can be used verser combinateur FAI with the tool xen-outils , Qui vous aide à CONSTRUIRE Xen Domaines invite. xen-outils are très bien versez Générer des Fichiers de configuration et les Périphériques en mode de bloc pour les Nouveaux clients de la base de des Commandes simples et / ous des Fichiers de configuration, but ILS ne PEUVENT Affecter non l' installation rôle nominale for the personnalisation. FAI-Utilisateurs Ont Besoin et veulent ainsi, ILS SONT voiture UTILISE Pour Que le system de classe. ILs Eux obtiennent, same Dans les installations xen-outils, en Utilisant le Code suivant Comme le script non xen-tools rôle:

 #!/bin/sh TARGET=$1 CMD="fai -N -v -u ${hostname} dirinstall $TARGET" echo running $CMD $CMD 

Ensuite, vous Aurez envie de définir la variable de install = 0 La configuration xen-tools verser this hôte.
Utilisation de FAI verser les mises à jour

FAI may also faire des mises à jour des Systèmes déjà en cours d'exécution, sans ré-installation à partir de zéro. Céci is Appelé Softupdate. Un Softupdate FAI ignorer Les Taches Qui ne are pas appropriés verser la mise à jour d'A system en cours d'exécution, Comme Le partitionnement des disques durs et la création de Systèmes de Fichiers. Au lieu de l' ACDE, il exécutons Les Taches de mise à jour et l'installation de Logiciels et de d'Appeler les scripts de personnalisation.

Verser exécuteur appel non Softupdate:

 # fai -v -s nfs://faiserver/srv/fai/config softupdate 

Par défaut, non Softupdate utiliser la liste des catégories définies LORs de l'installation initiale. ASSURER - vous de définir la grandeur $LOGSERVER(fait Dans Une . Classe var / * Fichier) si FAI devrait ENREGISTRER les Fichiers journaux sur la machine de juin distante.

Il is à vous, commenter demarrer juin Softupdate sur non plus les grands Nombre de postes d'hôtes. You can faire le Softupdate sur juin Régulière de base via cron ous vous can UTILISER des outils Comme clusterssh(1)à demarrer juin Softupdate via juin sur poussée juin liste d'hôtes.

Gardez à l ' esprit Que les scripts de personnalisation are Exécute each foie Que vous Faites non Softupdate. Cela signifié Qu'ils doivent Être idempotent ie le Résultat de their functioning Doït Toujours Produire le same Résultat, same Quand ILS Courent , plus d'Une Fois.

Par exemple l'ajout d'Une Ligne Dans un Initiation à ne pas faire obole via le code de ce:

 $ echo "some strings" >> /etc/fstab 

Au lieu d ' UTILISER la commande ainsl(1)Dans script shell non OÜ de la fonction de l' utilisation cfengine de AppendIfNoSuchLine .

Toutes Les Commandes Du scénario de personnalisation doivent Être capables de modificateur le Système de Fichiers cible wether il is available in / cible LORs de l'installation de Initiale ous CASTRES il is the system Fichiers normale par rapport à / au cours Softupdate.

VOICI QUELQUES Variables Sie aident à écrire des scripts de ces:

$target

    Points in the folder racine du client, Qui is_ / target_ LORs de l ' installation de et / pendentif juin Softupdate.
$FAI_ROOT

    Il is the same Valeur Que $target. Pour des Raisons historiques, AVONS NOUS bureaux Deux des variables FAI.
$ROOTCMD

    Dans Le Cas de L'alias c'est de l' ONU d'installation verser chroot $ cible en Cas de Softupdate il is juste vide. You can préfixer this aux Commandes si VOUS AVEZ Besoin d'Exécuter une commande A l ' intérieur Les clients des CIBLES Système de Fichiers via chroot.
$FAI_ACTION

    Si VOUS AVEZ Besoin d'Appeler du Code en fonction de l'Action de FAI éffectuée, vous can variables UTILISER this. Il contains l' ' action en cours d' exécution: installateur , Softupdate , dirinstall , sysinfo , inventaire ous Votre propre l' action definie.

Comment faire verser installateur 32bit OS à partir d'OS non 64bit

Pour l' installateur non ordinateur with a OS 32bit, VOUS AVEZ Besoin d'un nfsroot i386. La création de CE 32bit nfsroot sur non amd64 ejecutante l'installation de du serveur is Assez simple. Installer et configurateur les paquets FAI. Ensuite, copiez Vos Fichiers de configuration FAI à nouveau non sous-répertoire.

 faiserver# cp -a /etc/fai /etc/fai-i386 

Modifier la variable de $FAI_DEBOOTSTRAP_OPTSDans /etc/fai-i386/nfsroot.conf et ajoutez l'option de --arch i386. You can also auswählen non folder différent POUR VOTRE nouveau nfsroot. VOICI les Deux lignes après édition.

 NFSROOT=/srv/fai/nfsroot-i386 FAI_DEBOOTSTRAP_OPTS="--arch i386 --exclude=info --include=aptitude"" 

Maintenant Appeler make-fai-nfsroot Qui créé le nfsroot 32bit DANS / srv / fai / nfsroot-i386

 faiserver# fai-make-nfsroot -v -C/etc/fai-i386 

Création d ' ONU en miroir partitial Utilisant fai-mirror(1)CE Qui est Nécessaire Pour un ous CD juin clé USB is also possible l' architecture sur de juin Différente. Vous Devez spécificateur l'architecture de LORs de l ' appel fai-miroir.

 $ fai-mirror -m800 -B -a i386 -v -cDEFAULT,DEBIAN,FAIBASE,I386 /srv/mirror-i386 

C'est tout!
Divers Conseils et informations
La liste des Tâches

La Plupart des taches de l'are installation Definis COMME DES sous - programmes Qui sont Definis Dans / lib / fai / subroutines / usr (par exemple task_instsoft). CERTAINS are des scripts shell EXTERNES Situés Dans / usr / lib / fai / . ILs are appeles par l ' intermédiaire d' de sous un - programme supérieur Appelé Tâche . Ce sous - programme Qu'Appelle si disponible et crochets Appelle La Tâche Alors (definie Comme task_ <name> ). Une tache et ses crochets PEUVENT Être sautés à la Demande en Utilisant la commande skiptask () .

Maintenant, costume la description de toutes ses Les Taches, énumérées Dans l'ordre where are ILS Exécute.

confdir

    Les paramêtres du noyau en annexes definir des PEUVENT variables le démon syslog is Demarré. La liste des Périphériques réseau is Stocké Dans $netdevices. Ensuite, d ' Autres paramêtres are récupérés à partir d' non serveur DHCP. Le Fichier de configuration du résolveur DNS is created.

    L'emplacement de l'espace de configuration is definie par la grandeur $FAI_CONFIG_SRC.

    Après ACDE, les Fichiers $ FAI / crochets / subroutines est Source si Elle exists. L 'utilisation de CE Initiation, vous can définir Vos Propres routines OÜ cancel La sous - Définition Les des programmes de FAI.
installer

    This Tâche Définit l'heure du system, Tous $FAI_FLAGSare Definis et Deux Terminaux Virtuels supplementaires are à la ouverts request. Un démon de shell sécurisé is Demarré sur demande verser les Connexions distantes.
defclass

    Appels fai-class(1)de définir des catégories Utilisant des scripts et des Fichiers Dans $ FAI / classe ET des catégories DE / tmp / fai / autres classes et la grandeur $ADDCLASSES. La liste de Toutes Les catégories définies is stockée in the variables $classeset Enregistrée Dans / tmp / fai / FAI_CLASSES .
defvar

    Sources Tous les Fichiers $ FAI / class / *. Var verser each classe definie. Si l' ONU a crochet ECRIT Quelques définitions de variable Dans le Fichier $ LOGDIR / additional.var , this is also Initiation source.
action

    Fr Fonction De La Valeur obligatoire de $FAI_ACTIONsous de bureaux - programme déterminons l ' actions Qui Doït éffectuer la FAI. Les actions par défaut: DISPONIBLES are sysinfo , installateur , inventaire , dirinstall ET Softupdate . Si $FAI_ACTIONun juin Autre Valeur, l' action de juin definie par l'Utilisateur is Appelé si non Initiation $ FAI / Crochets FAI_ACTION / $ exists. AINSI, You can FACILEMENT definir Vos Propres actions.
sysinfo

    Appelé when installation Aucune is éffectuée, MAÏS L'Action is Sysinfo . Il affiche des informations sur le matériel Détecte et monte les disques durs en Locaux lecture Seule sur / target /partitionname ous par rapport à l' ONU fstab Initiation à l Trouvé ' intérieur d' une partition de juin. Les FICHIERS are Stockes in the serveur d 'journaux installation.
inventaire

    Une courte liste des informations sur le system is imprimé. 
installer

    This Tâche Contrôle la séquence d'installation. Vous entendrez des bips Trois Avant que l'Démarre d'installation. Le travail principale is d'Appeler d ' Autres Tâches et de la sortie à sauvegarder /tmp/fai/fai.log . Si VOUS AVEZ des Problèmes LORs de l ' installation, regardez Tous Les Fichiers / tmp / fai / . You can Pressothérapie des exemples de Fichiers journaux à http://fai-project.org/logs/ .
dirinstall

    Installer Dans folder un, pas sur non disque local. Utilisez-le verser des Environnements Créer chroot.
Softupdate

    This Tâche, exécutée à l ' intérieur d' A system en cours d'exécution par l ' intermédiaire de l' fai(8)interface de ligne de commande de, Effectue juin Softupdate. Voir le chapitre [Softupdate] verser en plus de détails.
cloison

    Les Appels setup-storage(8)verser partitionner les disques durs et de Créer des Systèmes de Fichiers. La Tache ECRIT les définitions de variable Pour la racine et la partition de demarrage et non dispositif ( $ROOT_PARTITION, $BOOT_PARTITION, $BOOT_DEVICE) à /tmp/fai/disk_var.sh et non Cris fstab Fichier pour le nouveau system.
mountdisks

    Monte les partitions créées en fonction de la création / tmp / fai / fstab Initiation par rapport à $FAI_ROOT.
extrbase

    Systéme non après minimes EXTRAIT chroot non can be faité en Elle. Par défaut, le goudron de la base Initiation à /var/tmp/base.tar.xz sérums extrait. Also les Fichiers correspondant à l' ONU nom de classé dans $ FAI / basefiles / `UTILISE de verser la Sont décompression d ' ONU Fichier goudron différents : selon les catégories définies. Céci can be used verser l ' installation de de various distributions Linux Que Celle Utilisée verser la création du nfsroot. Le Fichier par défaut base.tar.xz is a instantané d'A system de la base de created Debian par debootstrap(8)This Tâche utiliser la variable de FAI_BASEFILEURLverser recuperer le Fichier de base via FTP ous HTTP si Elle Est definie.
debconf

    Les APPELS fai-debconf(1)versez les définir facts de la Base de Données debconf de préconfiguration.
dépôt

    Préparer l ' Accès au dépôt de paquetages en préparant la configuration apt. Cela may also ajouter des clés du Référentiel via apt-key(8)juin sur la Manière basée classe de Fichiers Comme CLASSNAME.asc in the folder package_config .
updatebase

    Met à jour les paquets de la base du nouveau system et rencontré à jour la liste des paquets DISPONIBLES. Il also Quelques Commandes (appelées diversions) à l ' intérieur du nouveau system à l Installé' aide dpkg-divert(8), Fait pas de daemons sérums launched LORs de l'installation.
instsoft

    Installe les paquets souhaités en Utilisant des Fichiers de classé dans $ FAI / package_config / .
Configurer

    Scripts Appels Dans $ FAI / scripts / Et Ses sous - Répertoires versez each classe definie.
Tests

    Les Appels des scripts de tests en $ FAI / essais / et ses sous - Répertoires versez each classe definie.
terminer

    Démonte Tous les Systèmes de Fichiers Dans le nouveau system et SUPPRIME Installé les détournements de Fichiers en Utilisant la commande fai-divert.
chboot

    Changer la configuration PXE Pour un hôte sur le serveur d ' installation de Qui Indique Que PXELINUX configuration à chargeur LORs du demarrage de la Prochain carte réseau via TFTP. Par Conséquent, la fai-chboot(8)commande is exécutée à la distance sur le serveur d ' installation.
savelog

    Enregistre les Fichiers journaux sur le disque locale et le compte $LOGUSERsur $LOGSERVER(par défaut le serveur d ' installation).
faiend

    Attendez taches de fond versez terminer (par exemple, emacs compilation FICHIERS Lisp) et le client redémarre ous assister d'installation de verser la saisie manuelle avant le Redémarrage automatique. 

Les tests de Automatisés

Après les scripts de personnalisation are exécutées, FAI teste le exécutera Quelques CAS echeant. L 'utilisation de tests de CES, vous can verify les Erreurs de l'installation. Les scripts de are test appeles par l ' intermédiaire fai-do-scripts(1)et devront joindre SES messages par $ LOGDIR / test.log . Un module Perl, y compris sous CERTAINS - programmes Utiles can be trouvée Dans Faitest.pm . Un may test also définir Une nouvelle classe versez exécuteur Un autre des essais LORs de la Prochaine initialisation via la variable de $ADDCLASSES.
Autodiscover

En FAI 5.0, Nous Avons also juin Fonctionnalité Qui Permet aux clients de le Rechercher dans FAISERVER Dans their sous-réseau respectif. Ce Soulève la Nécessité d'Avoir à recueillir l'adresse MAC client de la each et configurateur le démon DHCP.

Cela se fait par le demarrage à partir d'Un petit bootmedium FAI autodiscover (CD, USB, etc.), Qui can be created via la commande:

 faiserver# fai-cd -A autodiscover.iso 

L'image de is à peu près 25Mo en taille et scanne le sous - réseau Pour un serveur FAI. Par défaut, il affiche le menu non with Tous les profils DISPONIBLES Dans l'espace de configuration de la same Manière Que le Menu de drapeau fait. Dans le menu de ce, vous can selectionner le type de l' installation d'Que vous souhaitez éffectuer.

Pour les clients de Pressothérapie le FAISERVER, le FAISERVER Doït exécuteur fai-moniteur.
Modification du dispositif d'amorçage

Modification de la séquence de demarrage se fait normalement Dans la configuration du BIOS. Mais vous ne pas changer le can BIOS à partir d'A system Linux.

AINSI, la séquence de demarrage du BIOS et Reste inchangé Votre ordinateur obole Toujours demarrer d ' Abord à partir de sa carte réseau et le second dispositif d'amorçage Doit Être le disque local. Ensuite, vous can changer le périphérique de demarrage du client en creant des configurations de PXELINUX Différentes. Cela permettra de définir si l' installation Une obole Être éffectuée, ous si le client Doït demarrer à partir du disque local. Cela se fait à l ' aide fai-chboot(8).
Commentaire Créer un miroir Debian local

Le scénario mkdebmirror
[You can Trouver le scénario Dans / usr / share / doc / fai-doc / examples / utils / ]
can be used for the création de Votre propre miroir Debian local. Ce script utilise la commande debmirror(1). Un miroir Debian partiel verser l ' architecture i386 ET amd64 verser Debian 8.0 (aka jessie) sans les paquets source un Besoin d' environ 56Go d'espace disque. Accès au miroir via HTTP sérums Le Moyen par défaut Dans la Plupart des CAS. Pour voir plus de sortie de l'appel de scénario mkdebmirror -v. Un Compte root is pas Nécessaire de Créer et de MAINTENIR le miroir Debian.

Pour l'Accès HTTP UTILISER au miroir Debian local, installateur non serveur Web et Créer un privilège non symbolique in the folder locale where your miroir is:

 faiserver# apt-get install apache2 faiserver# ln -s /files/scratch/debmirror /var/www/html/debmirror 

Créez un Fichier sources.list(5)Dans / etc / fai / apt Qui donne access to your miroir Debian. Also l'adresse IP ajouter du serveur HTTP à la variable de $NFSROOT_ETC_HOSTSDans nfsroot.conf si les clients have pas installateur la résolution DNS.
Petits conseils

    When vous utilisez l ' Accès HTTP à non miroir Debian, locale / var partition sur Tous les installateur les clients doivent Être Assez grande versez GARDER les paquets Debian téléchargés. Ne pas essayer de 250 with Moins Mo, Sauf si vous Savez Pourquoi. You can Limiteur le Nombre de paquets installés à la Fois Avec la grandeur $MAXPACKAGES.

    You can supprimer le logo rouge sur le client d ' une installation en appelant simplement resetUne Fois. Si sérums also ne pas apparaitre si vous Créez un Fichier en Utilisant this commande sur le serveur d ' installation de :

 touch /srv/fai/nfsroot/.nocolorlogo 

    Une liste des des variables utilisées par FAI can be found à http://wiki.fai-project.org/wiki/Variables .

    You can scripts de raccourcir CERTAINS en Utilisant personnalisation Une Seule commande fcopy fcopy -r / .

    Si vous reconstruisez le nfsroot, vous allez Créer Une nouvelle clé ssh hôte à l'intérieur du nfsroot. Ensuite, la connexion à client non d'installation de may échouer, Parce Que les Changements de clés hôte. You can UTILISER CECI:

 $ ssh -o StrictHostKeyChecking=no root@installclient 

    You can also supprimer l'entrée d'hôte sur Votre client d ' installation de Dañs Votre ~ / .ssh / known_hosts Initiation en Utilisant le -R ssh-keygen commande.

    Dans La Tâche chboot et savelog, connexion en juin non Utilisant shell sécurisé is ouvert sur le serveur FAI (voir [isavelog] ). Verser Veiller à Ce que ACDE Fonctionne de Façon non interactive, juin entrée correcte Dans nfsroot / root / .ssh / known_hosts Doit Être cries. When vous utilisez fai-setup, l' ACDE se fait automatiquement, Mais il may la exiger la modification manuelle au CAS where le nom de Votre serveur FAI n'à pas was specified correctement. If you Tombez - sur des Connexions ssh Sie nécessitent en Tapant «oui» Une ACCEPTER La Cle de l ' hôte LORs de l' installation, il vous plait Verifier Le contenu de Votre NFSROOT / Initiation root / .ssh / known_hosts

    Une liste de Tous les disques durs Locaux is Stocké Dans $disklist. Il is definition après Que l ' set_disk_infoOn appelle.

    Utilisez fai-divert -aSí le script postinst Qu'Appelle non programme de configuration non, le script par exemple le postinst verser le paquet apache Qu'Appelle apacheconfig, Qui a Besoin de saisie manuelle. You can truquer le programme de configuration Pour l'installation may Être Entièrement automatique.

    Parfois, l'installation de Semble Cesser, Mais il Souvent is only non scénario de poste d'ONU logiciel Qui Nécessite la saisie manuelle de la console. Changeur à non terminal Autre virtuel et de regarder quel Processus is actif with des outils Comme top(1)et pstree(1). You can ajouter debug à FAI_FLAGS verser Rendre Le Processus D'Installation Afficher toutes les Sorties des scripts postinst sur la console et also fils entrée à partir de la console.

    Commentaire Puis-je définir des cours sur la ligne de commande du noyau?

    Read la page de manuel de fai-class(8). Si vous souhaitez définir des classes d' supplementaires (par exemple, A, B, C) sur la ligne de commande du noyau ajouter CECI: ADDCLASSES = A, B, C

    Commentaire UTILISER non à noyau personnalisé l'intérieur du nfsroot?

    Construisez Votre noyau personnalisé en construisant non paquet de noyau en Utilisant make-kpkg(8)et l'option de UTILISER --initrd. Copiez this paquet Debian à Référentiel non locale et l ' ajouter à /etc/fai/sources.list. Ajoutez le nom de Votre colis Dans / etc / fai / NFSROOT. Appeler Ensuite

     # fai-make-nfsroot -k 

    Puis-je UTILISER UN noyau 4.X?

    Oui.Utilisation de FAI 5.1 et DRACUT 044 + 150-1 overlayfs (au lieu de aufs) is pris en charges, is Fait le noyau 4.x. When vous utilisez jessie Debian, You can UTILISER UN noyau de backports OÜ oeil non jeter à https://lists.uni-koeln.de/pipermail/linux-fai/2016-March/011283.html

    Commentaire UTILISER le nfsroot Comme system verser les clients sans disque?

    http://wiki.fai-project.org/wiki/Use_nfsroot_for_diskless_clients

    Commentaire several NFSROOT sur Serveurs Répertoires Un seul serveur FAI?

    Si vous Voulez Servir several Répertoires de nfsroot, vous Devez Créer des Répertoires de configuration Spécifiques Dans / etc verser FAI, Comme / etc / fai-jessie et / etc / fai-stretch . Ensuite, vous Devez définir les $NFSROOTvariables A Différents Répertoires et exécution

 faiserver#fai-make-nfsroot -c /etc/fai-jessie 

flag_reboot (FAI_FLAGS)

Si flag_reboot is regle, en ajoutant "reboot" pour $FAI_FLAGS, Votre client ordinateur redémarre après la Tâche faiend is Terminée. Cela is vrai versez le réseau AINSI Que des installations de bootmedium.
CentOS reboot

Après l'installation de CentOS Nécessite généralement Redémarrage non additional, en raison des correctifs de sécurité SELinux Qui sont appliqués post-installation.
Les FICHIERS journaux

FAI Cris several aux fichiers journaux. Pendant l ' installation, ILS are Stockes Dans / tmp / fai sur le client installateur lui - same. A la fin de l'installation, ILS will be COPIES sur le serveur d ' installation (voir [isavelog] ). Après l'installation de Du client redémarré DANS SON Système nouvellement Installé, vous can Pressothérapie les journaux de la FAI Dans / var / log / fai . Les FICHIERS journaux are also CRIS when vous Faites l'Softupdate OÜ dirinstall action.

Sur le FAISERVER, vous can Pressothérapie le (lointain) les Fichiers journaux Dans le répertoire ~ fai.

Fichiers journaux d'exemples Ordinateurs installés with succès is available sur http://fai-project.org/logs . CÉS non des Fichiers journaux Qui sont crees par FAI.

FAI_CLASSES

    Contains UNE LISTE de Toutes les catégories définies. 
dmesg.log

    Sortie de la dmesgcommande. Contient les messages Utiles de la mémoire tampon circulaire du noyau.
fai.log

    Le journal Initiation principale. CONTAINS TOUTES LES comerciaux IMPORTANTES. Vous devriez Toujours read this Initiation.
boot.log

    Une liste de Variables de paramêtres réseau, la Plupart du temps par le démon definition DHCP. 
format.log

    Sortie de l'outil de partition setup-storage(8).
shell.log

    Sortie de Tous les scripts shell, UTILISE Qui d'Sont Pour la personnalisation. 
variables.log

    Une liste de Toutes les Variables Du shell Qui is available LORs Installation d'en juin. 
error.log

    Un résumé des Erreurs possibles Dans Tous les Fichiers journaux. 
disk_var.sh

    Une liste de variable Qui contiennent des informations sur les Périphériques ET Partitions pour demarrer à partir, la partition racine et Une liste des Périphériques de swap. CÉS informations are utilisées scripts de pair CERTAINS personnalisation (par exemple GRUB_PC / 10-setup ).

Si le Processus d'installation de se Termine, le crochet savelog.LAST.sh recherche Tous les Fichiers journaux Pour Les Erreurs communes et les Écrit in the Initiation error.log . Fait, vous Devez d ' Abord regarder Dans this Fichier pour les Erreurs. Aussi le Fichier status.log vous donner ou le Code de sortie de la Dernière commande exécutée Dans le script un. Pour Etre Sur, vous devriez regarder verser en plus de détails Dans Tous les Fichiers journaux.
Commentaire HTTP UTILISER verser le demarrage PXE

 cp /usr/lib/PXELINUX/lpxelinux.0 /srv/tftp/fai/pxelinux.0 

Activer l'Accès HTTP au répertoire tftp:

 cd /var/www/html ln -s /srv/tftp/fai 

Ajouter -U URL à la fai-chboot appel. Par exemple:

 fai-chboot -U http://faiserver/fai -IFv ....... 

Dépannage
Erreurs de demarrage

Le message de d'erreur suivant Indique Que Votre client d'installation pas ne RECOIT de juin response à partir d ' non serveur DHCP. Vérifiez Vos Câbles ous demarrer le dhcpd(8)démon with the flag de débogage active.

 PXE-E51: No DHCP or BOOTP offers received Network boot aborted 

Si vous ne pas le Voyez un message suivant, le noyau d'installation de pas de N'a pu Détecter Votre carte réseau, par exemple en raison d'ONU pilote manquant:

 Starting dhcp for interface eth0 dhcp: PREINIT eth0 up dhcp: BOND setting eth 

Vérifiez la initrd in the nfsroot ( lsinird) si le pilote du noyau de Votre carte réseau is inclus là - bas et verify si vous souhaitez ajouter le paquet firmware-linux-nonfree Dans /etc/fai/NFSROOTet reconstruire le initrd en appellant fai-make-nfsroot -k. You can also ajouter non pilote à /srv/fai/nfsroot/etc/dracut.confla ligne add_drivers+ =.

Tel is the Message d'erreur, vous verrez, when your carte réseau Fonctionne, Mais le serveur d'Installation Ne pas exportateur le répertoire nfsroot aux clients installateur, Cela is Souvent Causé nominale Autorisations de MANQUE NFS sur le côté serveur.

 Starting dhcp for interface eth0 dhcp: PREINIT eth0 up dhcp: BOND setting eth mount.nfs: access denied by server while mounting 192.168.33.250:/srv/fai/nfsroot . . dracut Warning: Could not boot . Dropping to debug shell dracut:/# 

Maintenant, vous ÊTES à l ' intérieur de la coque d'urgence de l'initrd Qui a encore été définie par dracut (8) . Vous obtiendrez juin inviter du shell, et can regarder les Fichiers journaux. Pour plus de d ' informations sur le débogage du Processus de demarrage rapide en Utilisant dracut voirdracut.cmdline(7)

Utilisez la commande suivante sur le serveur d'installation de to see are exportes rapide Quels Répertoires à partir du serveur d'installation (FAISERVER Nommé):

 $ showmount -e faiserver 

Version 5.3
Dernière mise à jour 24/01/2017 15:09:25 CET
